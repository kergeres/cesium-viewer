define(["exports","./Matrix2-9aa31791","./when-4bbc8319","./RuntimeError-346a3079","./Transforms-d13cc04e","./ComponentDatatype-93750d1a"],function(a,t,e,r,n,i){"use strict";var s={};function o(a,t,e){var r=a+t;return i.CesiumMath.sign(a)!==i.CesiumMath.sign(t)&&Math.abs(r/Math.max(Math.abs(a),Math.abs(t)))<e?0:r}s.computeDiscriminant=function(a,t,e){return t*t-4*a*e},s.computeRealRoots=function(a,t,e){if(0===a)return 0===t?[]:[-e/t];if(0===t){if(0===e)return[0,0];var r,n=Math.abs(e),s=Math.abs(a);if(n<s&&n/s<i.CesiumMath.EPSILON14)return[0,0];if(n>s&&s/n<i.CesiumMath.EPSILON14||(r=-e/a)<0)return[];var u=Math.sqrt(r);return[-u,u]}if(0===e)return(r=-t/a)<0?[r,0]:[0,r];var C=o(t*t,-(4*a*e),i.CesiumMath.EPSILON14);if(C<0)return[];var c=-.5*o(t,i.CesiumMath.sign(t)*Math.sqrt(C),i.CesiumMath.EPSILON14);return t>0?[c/a,e/c]:[e/c,c/a]};var u={};function C(a,t,e,r){var n,i,s=t/3,o=e/3,u=a*o,C=s*r,c=s*s,l=o*o,h=a*o-c,M=a*r-s*o,m=s*r-l,f=4*h*m-M*M;if(f<0){c*C>=u*l?(d=a,g=h,v=-2*s*h+a*M):(d=r,g=m,v=-r*M+2*o*m);var d,g,v,p=-(v<0?-1:1)*Math.abs(d)*Math.sqrt(-f),w=(i=-v+p)/2,R=w<0?-Math.pow(-w,1/3):Math.pow(w,1/3),S=i===p?-R:-g/R;return n=g<=0?R+S:-v/(R*R+S*S+g),c*C>=u*l?[(n-s)/a]:[-r/(n+o)]}var O=Math.sqrt(f),x=Math.sqrt(3)/2,y=Math.abs(Math.atan2(a*O,-(-2*s*h+a*M))/3),P=Math.cos(y);i=(n=2*Math.sqrt(-h))*P;var b=n*(-P/2-x*Math.sin(y)),N=i+b>2*s?i-s:b-s,q=N/a;y=Math.abs(Math.atan2(r*O,-(-r*M+2*o*m))/3);var L=-r,I=(i=(n=2*Math.sqrt(-m))*(P=Math.cos(y)))+(b=n*(-P/2-x*Math.sin(y)))<2*o?i+o:b+o,E=L/I,z=-N*I-a*L,T=(o*z-s*(N*L))/(-s*z+o*(a*I));return q<=T?q<=E?T<=E?[q,T,E]:[q,E,T]:[E,q,T]:q<=E?[T,q,E]:T<=E?[T,E,q]:[E,T,q]}u.computeDiscriminant=function(a,t,e,r){var n=t*t,i=e*e;return 18*a*t*e*r+n*i-27*(a*a)*(r*r)-4*(a*i*e+n*t*r)},u.computeRealRoots=function(a,t,e,r){var n,i;if(0===a)return s.computeRealRoots(t,e,r);if(0===t){if(0===e){if(0===r)return[0,0,0];var o=(i=-r/a)<0?-Math.pow(-i,1/3):Math.pow(i,1/3);return[o,o,o]}return 0===r?0===(n=s.computeRealRoots(a,0,e)).Length?[0]:[n[0],0,n[1]]:C(a,0,e,r)}return 0===e?0===r?(i=-t/a)<0?[i,0,0]:[0,0,i]:C(a,t,0,r):0===r?0===(n=s.computeRealRoots(a,t,e)).length?[0]:n[1]<=0?[n[0],n[1],0]:n[0]>=0?[0,n[0],n[1]]:[n[0],0,n[1]]:C(a,t,e,r)};var c={};function l(a,r){r=t.Cartesian3.clone(e.defaultValue(r,t.Cartesian3.ZERO)),t.Cartesian3.equals(r,t.Cartesian3.ZERO)||t.Cartesian3.normalize(r,r),this.origin=t.Cartesian3.clone(e.defaultValue(a,t.Cartesian3.ZERO)),this.direction=r}c.computeDiscriminant=function(a,t,e,r,n){var i=a*a,s=t*t,o=s*t,u=e*e,C=u*e,c=r*r,l=c*r,h=n*n;return s*u*c-4*o*l-4*a*C*c+18*a*t*e*l-27*i*c*c+256*(i*a)*(h*n)+n*(18*o*e*r-4*s*C+16*a*u*u-80*a*t*u*r-6*a*s*c+144*i*e*c)+h*(144*a*s*e-27*s*s-128*i*u-192*i*t*r)},c.computeRealRoots=function(a,t,e,r,n){if(Math.abs(a)<i.CesiumMath.EPSILON15)return u.computeRealRoots(t,e,r,n);var o=t/a,C=e/a,c=r/a,l=n/a,h=o<0?1:0;switch(h+=C<0?h+1:h,h+=c<0?h+1:h,h+=l<0?h+1:h){case 0:case 3:case 4:case 6:case 7:case 9:case 10:case 12:case 13:case 14:case 15:return function(a,t,e,r){var n=a*a,o=t-3*n/8,C=e-t*a/2+n*a/8,c=r-e*a/4+t*n/16-3*n*n/256,l=u.computeRealRoots(1,2*o,o*o-4*c,-C*C);if(l.length>0){var h=-a/4,M=l[l.length-1];if(Math.abs(M)<i.CesiumMath.EPSILON14){var m=s.computeRealRoots(1,o,c);if(2===m.length){var f,d=m[0],g=m[1];if(d>=0&&g>=0){var v=Math.sqrt(d),p=Math.sqrt(g);return[h-p,h-v,h+v,h+p]}if(d>=0&&g<0)return[h-(f=Math.sqrt(d)),h+f];if(d<0&&g>=0)return[h-(f=Math.sqrt(g)),h+f]}return[]}if(M>0){var w=Math.sqrt(M),R=(o+M-C/w)/2,S=(o+M+C/w)/2,O=s.computeRealRoots(1,w,R),x=s.computeRealRoots(1,-w,S);return 0!==O.length?(O[0]+=h,O[1]+=h,0!==x.length?(x[0]+=h,x[1]+=h,O[1]<=x[0]?[O[0],O[1],x[0],x[1]]:x[1]<=O[0]?[x[0],x[1],O[0],O[1]]:O[0]>=x[0]&&O[1]<=x[1]?[x[0],O[0],O[1],x[1]]:x[0]>=O[0]&&x[1]<=O[1]?[O[0],x[0],x[1],O[1]]:O[0]>x[0]&&O[0]<x[1]?[x[0],O[0],x[1],O[1]]:[O[0],x[0],O[1],x[1]]):O):0!==x.length?(x[0]+=h,x[1]+=h,x):[]}}return[]}(o,C,c,l);case 1:case 2:case 5:case 8:case 11:return function(a,t,e,r){var n=a*a,o=u.computeRealRoots(1,-2*t,e*a+t*t-4*r,n*r-e*t*a+e*e);if(o.length>0){var C,c,l,h,M,m,f=o[0],d=t-f,g=d*d,v=a/2,p=d/2,w=g-4*r,R=n-4*f;if(f<0||w*(n+4*Math.abs(f))<R*(g+4*Math.abs(r))){var S=Math.sqrt(R);C=S/2,c=0===S?0:(a*p-e)/S}else{var O=Math.sqrt(w);C=0===O?0:(a*p-e)/O,c=O/2}0===v&&0===C?(l=0,h=0):i.CesiumMath.sign(v)===i.CesiumMath.sign(C)?h=f/(l=v+C):l=f/(h=v-C),0===p&&0===c?(M=0,m=0):i.CesiumMath.sign(p)===i.CesiumMath.sign(c)?m=r/(M=p+c):M=r/(m=p-c);var x=s.computeRealRoots(1,l,M),y=s.computeRealRoots(1,h,m);if(0!==x.length)return 0!==y.length?x[1]<=y[0]?[x[0],x[1],y[0],y[1]]:y[1]<=x[0]?[y[0],y[1],x[0],x[1]]:x[0]>=y[0]&&x[1]<=y[1]?[y[0],x[0],x[1],y[1]]:y[0]>=x[0]&&y[1]<=x[1]?[x[0],y[0],y[1],x[1]]:x[0]>y[0]&&x[0]<y[1]?[y[0],x[0],y[1],x[1]]:[x[0],y[0],x[1],y[1]]:x;if(0!==y.length)return y}return[]}(o,C,c,l);default:return}},l.clone=function(a,r){if(e.defined(a))return e.defined(r)?(r.origin=t.Cartesian3.clone(a.origin),r.direction=t.Cartesian3.clone(a.direction),r):new l(a.origin,a.direction)},l.getPoint=function(a,r,n){return e.defined(n)||(n=new t.Cartesian3),n=t.Cartesian3.multiplyByScalar(a.direction,r,n),t.Cartesian3.add(a.origin,n,n)};var h={rayPlane:function(a,r,n){e.defined(n)||(n=new t.Cartesian3);var s=a.origin,o=a.direction,u=r.normal,C=t.Cartesian3.dot(u,o);if(!(Math.abs(C)<i.CesiumMath.EPSILON15)){var c=(-r.distance-t.Cartesian3.dot(u,s))/C;if(!(c<0))return n=t.Cartesian3.multiplyByScalar(o,c,n),t.Cartesian3.add(s,n,n)}}},M=new t.Cartesian3,m=new t.Cartesian3,f=new t.Cartesian3,d=new t.Cartesian3,g=new t.Cartesian3;h.rayTriangleParametric=function(a,r,n,s,o){o=e.defaultValue(o,!1);var u,C,c,l,h,v=a.origin,p=a.direction,w=t.Cartesian3.subtract(n,r,M),R=t.Cartesian3.subtract(s,r,m),S=t.Cartesian3.cross(p,R,f),O=t.Cartesian3.dot(w,S);if(o){if(O<i.CesiumMath.EPSILON6||(u=t.Cartesian3.subtract(v,r,d),(c=t.Cartesian3.dot(u,S))<0||c>O)||(C=t.Cartesian3.cross(u,w,g),(l=t.Cartesian3.dot(p,C))<0||c+l>O))return;h=t.Cartesian3.dot(R,C)/O}else{if(Math.abs(O)<i.CesiumMath.EPSILON6)return;var x=1/O;if(u=t.Cartesian3.subtract(v,r,d),(c=t.Cartesian3.dot(u,S)*x)<0||c>1||(C=t.Cartesian3.cross(u,w,g),(l=t.Cartesian3.dot(p,C)*x)<0||c+l>1))return;h=t.Cartesian3.dot(R,C)*x}return h},h.rayTriangle=function(a,r,n,i,s,o){var u=h.rayTriangleParametric(a,r,n,i,s);if(e.defined(u)&&!(u<0))return e.defined(o)||(o=new t.Cartesian3),t.Cartesian3.multiplyByScalar(a.direction,u,o),t.Cartesian3.add(a.origin,o,o)};var v=new l;h.lineSegmentTriangle=function(a,r,n,i,s,o,u){t.Cartesian3.clone(a,v.origin),t.Cartesian3.subtract(r,a,v.direction),t.Cartesian3.normalize(v.direction,v.direction);var C=h.rayTriangleParametric(v,n,i,s,o);if(!(!e.defined(C)||C<0||C>t.Cartesian3.distance(a,r)))return e.defined(u)||(u=new t.Cartesian3),t.Cartesian3.multiplyByScalar(v.direction,C,u),t.Cartesian3.add(v.origin,u,u)};var p={root0:0,root1:0};function w(a,r,i){e.defined(i)||(i=new n.Interval);var s=a.origin,o=a.direction,u=r.center,C=r.radius*r.radius,c=t.Cartesian3.subtract(s,u,f),l=function(a,t,e,r){var n=t*t-4*a*e;if(!(n<0)){if(n>0){var i=1/(2*a),s=Math.sqrt(n),o=(-t+s)*i,u=(-t-s)*i;return o<u?(r.root0=o,r.root1=u):(r.root0=u,r.root1=o),r}var C=-t/(2*a);if(0!==C)return r.root0=r.root1=C,r}}(t.Cartesian3.dot(o,o),2*t.Cartesian3.dot(o,c),t.Cartesian3.magnitudeSquared(c)-C,p);if(e.defined(l))return i.start=l.root0,i.stop=l.root1,i}h.raySphere=function(a,t,r){if(r=w(a,t,r),e.defined(r)&&!(r.stop<0))return r.start=Math.max(r.start,0),r};var R=new l;h.lineSegmentSphere=function(a,r,n,i){t.Cartesian3.clone(a,R.origin);var s=t.Cartesian3.subtract(r,a,R.direction),o=t.Cartesian3.magnitude(s);if(t.Cartesian3.normalize(s,s),i=w(R,n,i),!(!e.defined(i)||i.stop<0||i.start>o))return i.start=Math.max(i.start,0),i.stop=Math.min(i.stop,o),i};var S=new t.Cartesian3,O=new t.Cartesian3;function x(a,t,e){var r=a+t;return i.CesiumMath.sign(a)!==i.CesiumMath.sign(t)&&Math.abs(r/Math.max(Math.abs(a),Math.abs(t)))<e?0:r}h.rayEllipsoid=function(a,e){var r,i,s,o,u,C=e.oneOverRadii,c=t.Cartesian3.multiplyComponents(C,a.origin,S),l=t.Cartesian3.multiplyComponents(C,a.direction,O),h=t.Cartesian3.magnitudeSquared(c),M=t.Cartesian3.dot(c,l);if(h>1){if(M>=0)return;var m=M*M;if(r=h-1,m<(s=(i=t.Cartesian3.magnitudeSquared(l))*r))return;if(m>s){o=M*M-s;var f=(u=-M+Math.sqrt(o))/i,d=r/u;return f<d?new n.Interval(f,d):{start:d,stop:f}}var g=Math.sqrt(r/i);return new n.Interval(g,g)}return h<1?(r=h-1,o=M*M-(s=(i=t.Cartesian3.magnitudeSquared(l))*r),u=-M+Math.sqrt(o),new n.Interval(0,u/i)):M<0?(i=t.Cartesian3.magnitudeSquared(l),new n.Interval(0,-M/i)):void 0};var y=new t.Cartesian3,P=new t.Cartesian3,b=new t.Cartesian3,N=new t.Cartesian3,q=new t.Cartesian3,L=new t.Matrix3,I=new t.Matrix3,E=new t.Matrix3,z=new t.Matrix3,T=new t.Matrix3,U=new t.Matrix3,W=new t.Matrix3,B=new t.Cartesian3,V=new t.Cartesian3,Z=new t.Cartographic;h.grazingAltitudeLocation=function(a,r){var n=a.origin,o=a.direction;if(!t.Cartesian3.equals(n,t.Cartesian3.ZERO)){var u=r.geodeticSurfaceNormal(n,y);if(t.Cartesian3.dot(o,u)>=0)return n}var C=e.defined(this.rayEllipsoid(a,r)),l=r.transformPositionToScaledSpace(o,y),h=t.Cartesian3.normalize(l,l),M=t.Cartesian3.mostOrthogonalAxis(l,N),m=t.Cartesian3.normalize(t.Cartesian3.cross(M,h,P),P),f=t.Cartesian3.normalize(t.Cartesian3.cross(h,m,b),b);L[0]=h.x,L[1]=h.y,L[2]=h.z,L[3]=m.x,L[4]=m.y,L[5]=m.z,L[6]=f.x,L[7]=f.y,L[8]=f.z;var d=t.Matrix3.transpose(L,I),g=t.Matrix3.fromScale(r.radii,E),v=t.Matrix3.fromScale(r.oneOverRadii,z);T[0]=0,T[1]=-o.z,T[2]=o.y,T[3]=o.z,T[4]=0,T[5]=-o.x,T[6]=-o.y,T[7]=o.x,T[8]=0;var p,w,R=t.Matrix3.multiply(t.Matrix3.multiply(d,v,U),T,U),S=t.Matrix3.multiply(t.Matrix3.multiply(R,g,W),L,W),O=t.Matrix3.multiplyByVector(R,n,q),D=function(a,e,r,n,o){var u,C=n*n,l=o*o,h=(a[t.Matrix3.COLUMN1ROW1]-a[t.Matrix3.COLUMN2ROW2])*l,M=o*(n*x(a[t.Matrix3.COLUMN1ROW0],a[t.Matrix3.COLUMN0ROW1],i.CesiumMath.EPSILON15)+e.y),m=a[t.Matrix3.COLUMN0ROW0]*C+a[t.Matrix3.COLUMN2ROW2]*l+n*e.x+0,f=l*x(a[t.Matrix3.COLUMN2ROW1],a[t.Matrix3.COLUMN1ROW2],i.CesiumMath.EPSILON15),d=o*(n*x(a[t.Matrix3.COLUMN2ROW0],a[t.Matrix3.COLUMN0ROW2])+e.z),g=[];if(0===d&&0===f){if(0===(u=s.computeRealRoots(h,M,m)).length)return g;var v=u[0],p=Math.sqrt(Math.max(1-v*v,0));if(g.push(new t.Cartesian3(n,o*v,-(o*p))),g.push(new t.Cartesian3(n,o*v,o*p)),2===u.length){var w=u[1],R=Math.sqrt(Math.max(1-w*w,0));g.push(new t.Cartesian3(n,o*w,-(o*R))),g.push(new t.Cartesian3(n,o*w,o*R))}return g}var S=d*d,O=f*f,y=d*f,P=h*h+O,b=2*(M*h+y),N=2*m*h+M*M-O+S,q=2*(m*M-y),L=m*m-S;if(0===P&&0===b&&0===N&&0===q)return g;var I=(u=c.computeRealRoots(P,b,N,q,L)).length;if(0===I)return g;for(var E=0;E<I;++E){var z=u[E],T=z*z,U=Math.sqrt(Math.max(1-T,0)),W=(i.CesiumMath.sign(h)===i.CesiumMath.sign(m)?x(h*T+m,M*z,i.CesiumMath.EPSILON12):i.CesiumMath.sign(m)===i.CesiumMath.sign(M*z)?x(h*T,M*z+m,i.CesiumMath.EPSILON12):x(h*T+M*z,m,i.CesiumMath.EPSILON12))*x(f*z,d,i.CesiumMath.EPSILON15);W<0?g.push(new t.Cartesian3(n,o*z,o*U)):W>0?g.push(new t.Cartesian3(n,o*z,-(o*U))):0!==U?(g.push(new t.Cartesian3(n,o*z,-(o*U))),g.push(new t.Cartesian3(n,o*z,o*U)),++E):g.push(new t.Cartesian3(n,o*z,o*U))}return g}(S,t.Cartesian3.negate(O,y),0,0,1),A=D.length;if(A>0){for(var F=t.Cartesian3.clone(t.Cartesian3.ZERO,V),G=Number.NEGATIVE_INFINITY,Y=0;Y<A;++Y){p=t.Matrix3.multiplyByVector(g,t.Matrix3.multiplyByVector(L,D[Y],B),B);var _=t.Cartesian3.normalize(t.Cartesian3.subtract(p,n,N),N),j=t.Cartesian3.dot(_,o);j>G&&(G=j,F=t.Cartesian3.clone(p,F))}var k=r.cartesianToCartographic(F,Z);return G=i.CesiumMath.clamp(G,0,1),w=t.Cartesian3.magnitude(t.Cartesian3.subtract(F,n,N))*Math.sqrt(1-G*G),w=C?-w:w,k.height=w,r.cartographicToCartesian(k,new t.Cartesian3)}};var D=new t.Cartesian3;h.lineSegmentPlane=function(a,r,n,s){e.defined(s)||(s=new t.Cartesian3);var o=t.Cartesian3.subtract(r,a,D),u=n.normal,C=t.Cartesian3.dot(u,o);if(!(Math.abs(C)<i.CesiumMath.EPSILON6)){var c=t.Cartesian3.dot(u,a),l=-(n.distance+c)/C;if(!(l<0||l>1))return t.Cartesian3.multiplyByScalar(o,l,s),t.Cartesian3.add(a,s,s),s}},h.trianglePlaneIntersection=function(a,e,r,n){var i,s,o,u=n.normal,C=n.distance,c=t.Cartesian3.dot(u,a)+C<0,l=t.Cartesian3.dot(u,e)+C<0,M=t.Cartesian3.dot(u,r)+C<0;if(1!=(o=0+((c?1:0)+(l?1:0)+(M?1:0)))&&2!==o||(i=new t.Cartesian3,s=new t.Cartesian3),1===o){if(c)return h.lineSegmentPlane(a,e,n,i),h.lineSegmentPlane(a,r,n,s),{positions:[a,e,r,i,s],indices:[0,3,4,1,2,4,1,4,3]};if(l)return h.lineSegmentPlane(e,r,n,i),h.lineSegmentPlane(e,a,n,s),{positions:[a,e,r,i,s],indices:[1,3,4,2,0,4,2,4,3]};if(M)return h.lineSegmentPlane(r,a,n,i),h.lineSegmentPlane(r,e,n,s),{positions:[a,e,r,i,s],indices:[2,3,4,0,1,4,0,4,3]}}else if(2===o){if(!c)return h.lineSegmentPlane(e,a,n,i),h.lineSegmentPlane(r,a,n,s),{positions:[a,e,r,i,s],indices:[1,2,4,1,4,3,0,3,4]};if(!l)return h.lineSegmentPlane(r,e,n,i),h.lineSegmentPlane(a,e,n,s),{positions:[a,e,r,i,s],indices:[2,0,4,2,4,3,1,3,4]};if(!M)return h.lineSegmentPlane(a,r,n,i),h.lineSegmentPlane(e,r,n,s),{positions:[a,e,r,i,s],indices:[0,1,4,0,4,3,2,3,4]}}},a.IntersectionTests=h,a.Ray=l});