define(["exports","./Matrix2-9aa31791","./when-4bbc8319","./RuntimeError-346a3079","./EllipsoidGeodesic-dd8f2afb","./EllipsoidRhumbLine-30c47ff4","./IntersectionTests-96a04219","./ComponentDatatype-93750d1a","./Plane-318d6937"],function(a,e,r,t,i,n,o,s,c){"use strict";var l={numberOfPoints:function(a,r,t){return Math.ceil(e.Cartesian3.distance(a,r)/t)},numberOfPointsRhumbLine:function(a,e,r){return Math.max(1,Math.ceil(Math.sqrt((Math.pow(a.longitude-e.longitude,2)+Math.pow(a.latitude-e.latitude,2))/(r*r))))}},u=new e.Cartographic;l.extractHeights=function(a,e){for(var r=a.length,t=Array(r),i=0;i<r;i++){var n=a[i];t[i]=e.cartesianToCartographic(n,u).height}return t};var h=new e.Matrix4,f=new e.Cartesian3,g=new e.Cartesian3,C=new c.Plane(e.Cartesian3.UNIT_X,0),p=new e.Cartesian3,d=new c.Plane(e.Cartesian3.UNIT_X,0),v=new e.Cartesian3,m=new e.Cartesian3,P=[];function T(a,e,r){if(P.length=a,e===r){for(t=0;t<a;t++)P[t]=e;return P}var t,i=(r-e)/a;for(t=0;t<a;t++){var n=e+t*i;P[t]=n}return P}var y=new e.Cartographic,w=new e.Cartographic,A=new e.Cartesian3,E=new e.Cartesian3,b=new e.Cartesian3,R=new i.EllipsoidGeodesic,M=new n.EllipsoidRhumbLine;l.wrapLongitude=function(a,t){var i=[],n=[];if(r.defined(a)&&a.length>0){t=r.defaultValue(t,e.Matrix4.IDENTITY);var s=e.Matrix4.inverseTransformation(t,h),l=e.Matrix4.multiplyByPoint(s,e.Cartesian3.ZERO,f),u=e.Cartesian3.normalize(e.Matrix4.multiplyByPointAsVector(s,e.Cartesian3.UNIT_Y,g),g),P=c.Plane.fromPointNormal(l,u,C),T=e.Cartesian3.normalize(e.Matrix4.multiplyByPointAsVector(s,e.Cartesian3.UNIT_X,p),p),y=c.Plane.fromPointNormal(l,T,d),w=1;i.push(e.Cartesian3.clone(a[0]));for(var A=i[0],E=a.length,b=1;b<E;++b){var R=a[b];if(0>c.Plane.getPointDistance(y,A)||0>c.Plane.getPointDistance(y,R)){var M=o.IntersectionTests.lineSegmentPlane(A,R,P,v);if(r.defined(M)){var S=e.Cartesian3.multiplyByScalar(u,5e-9,m);0>c.Plane.getPointDistance(P,A)&&e.Cartesian3.negate(S,S),i.push(e.Cartesian3.add(M,S,new e.Cartesian3)),n.push(w+1),e.Cartesian3.negate(S,S),i.push(e.Cartesian3.add(M,S,new e.Cartesian3)),w=1}}i.push(e.Cartesian3.clone(a[b])),w++,A=R}n.push(w)}return{positions:i,lengths:n}},l.generateArc=function(a){r.defined(a)||(a={});var t=a.positions,i=t.length,n=r.defaultValue(a.ellipsoid,e.Ellipsoid.WGS84),o=r.defaultValue(a.height,0),c=Array.isArray(o);if(i<1)return[];if(1===i){var u=n.scaleToGeodeticSurface(t[0],E);if(0!==(o=c?o[0]:o)){var h=n.geodeticSurfaceNormal(u,A);e.Cartesian3.multiplyByScalar(h,o,h),e.Cartesian3.add(u,h,u)}return[u.x,u.y,u.z]}var f=a.minDistance;if(!r.defined(f)){var g=r.defaultValue(a.granularity,s.CesiumMath.RADIANS_PER_DEGREE);f=s.CesiumMath.chordLength(g,n.maximumRadius)}var C,p=0;for(C=0;C<i-1;C++)p+=l.numberOfPoints(t[C],t[C+1],f);var d=3*(p+1),v=Array(d),m=0;for(C=0;C<i-1;C++)m=function(a,r,t,i,n,o,s,c){var u=i.scaleToGeodeticSurface(a,E),h=i.scaleToGeodeticSurface(r,b),f=l.numberOfPoints(a,r,t),g=i.cartesianToCartographic(u,y),C=i.cartesianToCartographic(h,w),p=T(f,n,o);R.setEndPoints(g,C);var d=R.surfaceDistance/f,v=c;g.height=n;var m=i.cartographicToCartesian(g,A);e.Cartesian3.pack(m,s,v),v+=3;for(var P=1;P<f;P++){var M=R.interpolateUsingSurfaceDistance(P*d,w);M.height=p[P],m=i.cartographicToCartesian(M,A),e.Cartesian3.pack(m,s,v),v+=3}return v}(t[C],t[C+1],f,n,c?o[C]:o,c?o[C+1]:o,v,m);P.length=0;var M=t[i-1],S=n.cartesianToCartographic(M,y);S.height=c?o[i-1]:o;var D=n.cartographicToCartesian(S,A);return e.Cartesian3.pack(D,v,d-3),v};var S=new e.Cartographic,D=new e.Cartographic;l.generateRhumbArc=function(a){r.defined(a)||(a={});var t=a.positions,i=t.length,o=r.defaultValue(a.ellipsoid,e.Ellipsoid.WGS84),c=r.defaultValue(a.height,0),u=Array.isArray(c);if(i<1)return[];if(1===i){var h=o.scaleToGeodeticSurface(t[0],E);if(0!==(c=u?c[0]:c)){var f=o.geodeticSurfaceNormal(h,A);e.Cartesian3.multiplyByScalar(f,c,f),e.Cartesian3.add(h,f,h)}return[h.x,h.y,h.z]}var g,C,p=r.defaultValue(a.granularity,s.CesiumMath.RADIANS_PER_DEGREE),d=0,v=o.cartesianToCartographic(t[0],S);for(g=0;g<i-1;g++)C=o.cartesianToCartographic(t[g+1],D),d+=l.numberOfPointsRhumbLine(v,C,p),v=e.Cartographic.clone(C,S);var m=3*(d+1),b=Array(m),R=0;for(g=0;g<i-1;g++)R=function(a,r,t,i,o,s,c,u){var h=i.cartesianToCartographic(a,y),f=i.cartesianToCartographic(r,w),g=l.numberOfPointsRhumbLine(h,f,t);h.height=0,f.height=0;var C=T(g,o,s);M.ellipsoid.equals(i)||(M=new n.EllipsoidRhumbLine(void 0,void 0,i)),M.setEndPoints(h,f);var p=M.surfaceDistance/g,d=u;h.height=o;var v=i.cartographicToCartesian(h,A);e.Cartesian3.pack(v,c,d),d+=3;for(var m=1;m<g;m++){var P=M.interpolateUsingSurfaceDistance(m*p,w);P.height=C[m],v=i.cartographicToCartesian(P,A),e.Cartesian3.pack(v,c,d),d+=3}return d}(t[g],t[g+1],p,o,u?c[g]:c,u?c[g+1]:c,b,R);P.length=0;var x=t[i-1],N=o.cartesianToCartographic(x,y);N.height=u?c[i-1]:c;var G=o.cartographicToCartesian(N,A);return e.Cartesian3.pack(G,b,m-3),b},l.generateCartesianArc=function(a){for(var r=l.generateArc(a),t=r.length/3,i=Array(t),n=0;n<t;n++)i[n]=e.Cartesian3.unpack(r,3*n);return i},l.generateCartesianRhumbArc=function(a){for(var r=l.generateRhumbArc(a),t=r.length/3,i=Array(t),n=0;n<t;n++)i[n]=e.Cartesian3.unpack(r,3*n);return i},a.PolylinePipeline=l});