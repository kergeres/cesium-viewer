define(["exports","./Math-355606c6","./Matrix2-7a8e9daf","./Matrix3-b2351961","./ComponentDatatype-ab629b88","./defaultValue-f6d5e6da","./EllipsoidRhumbLine-1289f7e8","./GeometryAttribute-9c1a6bab","./WebGLConstants-7f557f93"],function(e,t,n,r,a,i,u,o,s){"use strict";var x={exports:{}};function l(e,t,n){n=n||2;var r,a,i,u,o,s,x,l=t&&t.length,C=l?t[0]*n:e.length,g=p(e,0,C,n,!0),A=[];if(!g||g.next===g.prev)return A;if(l&&(g=function(e,t,n,r){var a,i,u,o=[];for(a=0,i=t.length;a<i;a++)(u=p(e,t[a]*r,a<i-1?t[a+1]*r:e.length,r,!1))===u.next&&(u.steiner=!0),o.push(function(e){var t=e,n=e;do(t.x<n.x||t.x===n.x&&t.y<n.y)&&(n=t),t=t.next;while(t!==e);return n}(u));for(o.sort(y),a=0;a<o.length;a++)n=function(e,t){var n=function(e,t){var n,r,a,i=t,u=e.x,o=e.y,s=-1/0;do{if(o<=i.y&&o>=i.next.y&&i.next.y!==i.y){var x=i.x+(o-i.y)*(i.next.x-i.x)/(i.next.y-i.y);if(x<=u&&x>s&&(s=x,a=i.x<i.next.x?i:i.next,x===u))return a}i=i.next}while(i!==t);if(!a)return null;var l,p=a,h=a.x,y=a.y,f=1/0;i=a;do u>=i.x&&i.x>=h&&u!==i.x&&v(o<y?u:s,o,h,y,o<y?s:u,o,i.x,i.y)&&(l=Math.abs(o-i.y)/(u-i.x),b(i,e)&&(l<f||l===f&&(i.x>a.x||i.x===a.x&&(n=a,r=i,0>c(n.prev,n,r.prev)&&0>c(r.next,n,n.next))))&&(a=i,f=l)),i=i.next;while(i!==p);return a}(e,t);if(!n)return t;var r=w(n,e);return h(r,r.next),h(n,n.next)}(o[a],n);return n}(e,t,g,n)),e.length>80*n){r=i=e[0],a=u=e[1];for(var S=n;S<C;S+=n)(o=e[S])<r&&(r=o),(s=e[S+1])<a&&(a=s),o>i&&(i=o),s>u&&(u=s);x=0!==(x=Math.max(i-r,u-a))?32767/x:0}return function e(t,n,r,a,i,u,o){if(t){!o&&u&&function(e,t,n,r){var a=e;do 0===a.z&&(a.z=f(a.x,a.y,t,n,r)),a.prevZ=a.prev,a.nextZ=a.next,a=a.next;while(a!==e);a.prevZ.nextZ=null,a.prevZ=null,function(e){var t,n,r,a,i,u,o,s,x=1;do{for(n=e,e=null,i=null,u=0;n;){for(u++,r=n,o=0,t=0;t<x&&(o++,r=r.nextZ);t++);for(s=x;o>0||s>0&&r;)0!==o&&(0===s||!r||n.z<=r.z)?(a=n,n=n.nextZ,o--):(a=r,r=r.nextZ,s--),i?i.nextZ=a:e=a,a.prevZ=i,i=a;n=r}i.nextZ=null,x*=2}while(u>1)}(a)}(t,a,i,u);for(var s,x,l=t;t.prev!==t.next;)if(s=t.prev,x=t.next,u?function(e,t,n,r){var a=e.prev,i=e.next;if(c(a,e,i)>=0)return!1;for(var u=a.x,o=e.x,s=i.x,x=a.y,l=e.y,p=i.y,h=u<o?u<s?u:s:o<s?o:s,y=x<l?x<p?x:p:l<p?l:p,d=u>o?u>s?u:s:o>s?o:s,m=x>l?x>p?x:p:l>p?l:p,C=f(h,y,t,n,r),g=f(d,m,t,n,r),b=e.prevZ,w=e.nextZ;b&&b.z>=C&&w&&w.z<=g;){if(b.x>=h&&b.x<=d&&b.y>=y&&b.y<=m&&b!==a&&b!==i&&v(u,x,o,l,s,p,b.x,b.y)&&c(b.prev,b,b.next)>=0||(b=b.prevZ,w.x>=h&&w.x<=d&&w.y>=y&&w.y<=m&&w!==a&&w!==i&&v(u,x,o,l,s,p,w.x,w.y)&&c(w.prev,w,w.next)>=0))return!1;w=w.nextZ}for(;b&&b.z>=C;){if(b.x>=h&&b.x<=d&&b.y>=y&&b.y<=m&&b!==a&&b!==i&&v(u,x,o,l,s,p,b.x,b.y)&&c(b.prev,b,b.next)>=0)return!1;b=b.prevZ}for(;w&&w.z<=g;){if(w.x>=h&&w.x<=d&&w.y>=y&&w.y<=m&&w!==a&&w!==i&&v(u,x,o,l,s,p,w.x,w.y)&&c(w.prev,w,w.next)>=0)return!1;w=w.nextZ}return!0}(t,a,i,u):function(e){var t=e.prev,n=e.next;if(c(t,e,n)>=0)return!1;for(var r=t.x,a=e.x,i=n.x,u=t.y,o=e.y,s=n.y,x=r<a?r<i?r:i:a<i?a:i,l=u<o?u<s?u:s:o<s?o:s,p=r>a?r>i?r:i:a>i?a:i,h=u>o?u>s?u:s:o>s?o:s,y=n.next;y!==t;){if(y.x>=x&&y.x<=p&&y.y>=l&&y.y<=h&&v(r,u,a,o,i,s,y.x,y.y)&&c(y.prev,y,y.next)>=0)return!1;y=y.next}return!0}(t))n.push(s.i/r|0),n.push(t.i/r|0),n.push(x.i/r|0),M(t),t=x.next,l=x.next;else if((t=x)===l){o?1===o?e(t=function(e,t,n){var r=e;do{var a=r.prev,i=r.next.next;!d(a,i)&&m(a,r,r.next,i)&&b(a,i)&&b(i,a)&&(t.push(a.i/n|0),t.push(r.i/n|0),t.push(i.i/n|0),M(r),M(r.next),r=e=i),r=r.next}while(r!==e);return h(r)}(h(t),n,r),n,r,a,i,u,2):2===o&&function(t,n,r,a,i,u){var o=t;do{for(var s,x,l=o.next.next;l!==o.prev;){if(o.i!==l.i&&(s=o,x=l,s.next.i!==x.i&&s.prev.i!==x.i&&!function(e,t){var n=e;do{if(n.i!==e.i&&n.next.i!==e.i&&n.i!==t.i&&n.next.i!==t.i&&m(n,n.next,e,t))return!0;n=n.next}while(n!==e);return!1}(s,x)&&(b(s,x)&&b(x,s)&&function(e,t){var n=e,r=!1,a=(e.x+t.x)/2,i=(e.y+t.y)/2;do n.y>i!=n.next.y>i&&n.next.y!==n.y&&a<(n.next.x-n.x)*(i-n.y)/(n.next.y-n.y)+n.x&&(r=!r),n=n.next;while(n!==e);return r}(s,x)&&(c(s.prev,s,x.prev)||c(s,x.prev,x))||d(s,x)&&c(s.prev,s,s.next)>0&&c(x.prev,x,x.next)>0))){var p=w(o,l);return o=h(o,o.next),p=h(p,p.next),e(o,n,r,a,i,u,0),void e(p,n,r,a,i,u,0)}l=l.next}o=o.next}while(o!==t)}(t,n,r,a,i,u):e(h(t),n,r,a,i,u,1);break}}}(g,A,n,r,a,x,0),A}function p(e,t,n,r,a){var i,u;if(a===E(e,t,n,r)>0)for(i=t;i<n;i+=r)u=A(i,e[i],e[i+1],u);else for(i=n-r;i>=t;i-=r)u=A(i,e[i],e[i+1],u);return u&&d(u,u.next)&&(M(u),u=u.next),u}function h(e,t){if(!e)return e;t||(t=e);var n,r=e;do if(n=!1,r.steiner||!d(r,r.next)&&0!==c(r.prev,r,r.next))r=r.next;else{if(M(r),(r=t=r.prev)===r.next)break;n=!0}while(n||r!==t);return t}function y(e,t){return e.x-t.x}function f(e,t,n,r,a){return(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=(e-n)*a|0)|e<<8))|e<<4))|e<<2))|e<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=(t-r)*a|0)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function v(e,t,n,r,a,i,u,o){return(a-u)*(t-o)>=(e-u)*(i-o)&&(e-u)*(r-o)>=(n-u)*(t-o)&&(n-u)*(i-o)>=(a-u)*(r-o)}function c(e,t,n){return(t.y-e.y)*(n.x-t.x)-(t.x-e.x)*(n.y-t.y)}function d(e,t){return e.x===t.x&&e.y===t.y}function m(e,t,n,r){var a=g(c(e,t,n)),i=g(c(e,t,r)),u=g(c(n,r,e)),o=g(c(n,r,t));return a!==i&&u!==o||!(0!==a||!C(e,n,t))||!(0!==i||!C(e,r,t))||!(0!==u||!C(n,e,r))||!(0!==o||!C(n,t,r))}function C(e,t,n){return t.x<=Math.max(e.x,n.x)&&t.x>=Math.min(e.x,n.x)&&t.y<=Math.max(e.y,n.y)&&t.y>=Math.min(e.y,n.y)}function g(e){return e>0?1:e<0?-1:0}function b(e,t){return 0>c(e.prev,e,e.next)?c(e,t,e.next)>=0&&c(e,e.prev,t)>=0:0>c(e,t,e.prev)||0>c(e,e.next,t)}function w(e,t){var n=new S(e.i,e.x,e.y),r=new S(t.i,t.x,t.y),a=e.next,i=t.prev;return e.next=t,t.prev=e,n.next=a,a.prev=n,r.next=n,n.prev=r,i.next=r,r.prev=i,r}function A(e,t,n,r){var a=new S(e,t,n);return r?(a.next=r.next,a.prev=r,r.next.prev=a,r.next=a):(a.prev=a,a.next=a),a}function M(e){e.next.prev=e.prev,e.prev.next=e.next,e.prevZ&&(e.prevZ.nextZ=e.nextZ),e.nextZ&&(e.nextZ.prevZ=e.prevZ)}function S(e,t,n){this.i=e,this.x=t,this.y=n,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function E(e,t,n,r){for(var a=0,i=t,u=n-r;i<n;i+=r)a+=(e[u]-e[i])*(e[i+1]+e[u+1]),u=i;return a}x.exports=l,x.exports.default=l,l.deviation=function(e,t,n,r){var a=t&&t.length,i=a?t[0]*n:e.length,u=Math.abs(E(e,0,i,n));if(a)for(var o=0,s=t.length;o<s;o++){var x=t[o]*n,l=o<s-1?t[o+1]*n:e.length;u-=Math.abs(E(e,x,l,n))}var p=0;for(o=0;o<r.length;o+=3){var h=r[o]*n,y=r[o+1]*n,f=r[o+2]*n;p+=Math.abs((e[h]-e[f])*(e[y+1]-e[h+1])-(e[h]-e[y])*(e[f+1]-e[h+1]))}return 0===u&&0===p?0:Math.abs((p-u)/u)},l.flatten=function(e){for(var t=e[0][0].length,n={vertices:[],holes:[],dimensions:t},r=0,a=0;a<e.length;a++){for(var i=0;i<e[a].length;i++)for(var u=0;u<t;u++)n.vertices.push(e[a][i][u]);a>0&&(r+=e[a-1].length,n.holes.push(r))}return n};var Z=x.exports,z=t.getDefaultExportFromCjs(Z);let D={CLOCKWISE:s.WebGLConstants.CW,COUNTER_CLOCKWISE:s.WebGLConstants.CCW,validate:function(e){return e===D.CLOCKWISE||e===D.COUNTER_CLOCKWISE}};var L=Object.freeze(D);let R=new r.Cartesian3,G=new r.Cartesian3,O={computeArea2D:function(e){let t=e.length,n=0;for(let r=t-1,a=0;a<t;r=a++){let t=e[r],i=e[a];n+=t.x*i.y-i.x*t.y}return .5*n},computeWindingOrder2D:function(e){return O.computeArea2D(e)>0?L.COUNTER_CLOCKWISE:L.CLOCKWISE},triangulate:function(e,t){let r=n.Cartesian2.packArray(e);return z(r,t,2)}},T=new r.Cartesian3,B=new r.Cartesian3,W=new r.Cartesian3,P=new r.Cartesian3,$=new r.Cartesian3,I=new r.Cartesian3,N=new r.Cartesian3,U=new n.Cartesian2,_=new n.Cartesian2,F=new n.Cartesian2,K=new n.Cartesian2;O.computeSubdivision=function(e,u,s,x,l){let p;l=i.defaultValue(l,t.CesiumMath.RADIANS_PER_DEGREE);let h=i.defined(x),y=s.slice(0),f=u.length,v=Array(3*f),c=Array(2*f),d=0,m=0;for(p=0;p<f;p++){let e=u[p];if(v[d++]=e.x,v[d++]=e.y,v[d++]=e.z,h){let e=x[p];c[m++]=e.x,c[m++]=e.y}}let C=[],g={},b=e.maximumRadius,w=t.CesiumMath.chordLength(l,b),A=w*w;for(;y.length>0;){let e,t,a,u,o,s;let x=y.pop(),l=y.pop(),f=y.pop(),d=r.Cartesian3.fromArray(v,3*f,T),m=r.Cartesian3.fromArray(v,3*l,B),w=r.Cartesian3.fromArray(v,3*x,W);h&&(e=n.Cartesian2.fromArray(c,2*f,U),t=n.Cartesian2.fromArray(c,2*l,_),a=n.Cartesian2.fromArray(c,2*x,F));let M=r.Cartesian3.multiplyByScalar(r.Cartesian3.normalize(d,P),b,P),S=r.Cartesian3.multiplyByScalar(r.Cartesian3.normalize(m,$),b,$),E=r.Cartesian3.multiplyByScalar(r.Cartesian3.normalize(w,I),b,I),Z=r.Cartesian3.magnitudeSquared(r.Cartesian3.subtract(M,S,N)),z=r.Cartesian3.magnitudeSquared(r.Cartesian3.subtract(S,E,N)),D=r.Cartesian3.magnitudeSquared(r.Cartesian3.subtract(E,M,N)),L=Math.max(Z,z,D);L>A?Z===L?(p=g[u=`${Math.min(f,l)} ${Math.max(f,l)}`],i.defined(p)||(o=r.Cartesian3.add(d,m,N),r.Cartesian3.multiplyByScalar(o,.5,o),v.push(o.x,o.y,o.z),p=v.length/3-1,g[u]=p,h&&(s=n.Cartesian2.add(e,t,K),n.Cartesian2.multiplyByScalar(s,.5,s),c.push(s.x,s.y))),y.push(f,p,x),y.push(p,l,x)):z===L?(p=g[u=`${Math.min(l,x)} ${Math.max(l,x)}`],i.defined(p)||(o=r.Cartesian3.add(m,w,N),r.Cartesian3.multiplyByScalar(o,.5,o),v.push(o.x,o.y,o.z),p=v.length/3-1,g[u]=p,h&&(s=n.Cartesian2.add(t,a,K),n.Cartesian2.multiplyByScalar(s,.5,s),c.push(s.x,s.y))),y.push(l,p,f),y.push(p,x,f)):D===L&&(p=g[u=`${Math.min(x,f)} ${Math.max(x,f)}`],i.defined(p)||(o=r.Cartesian3.add(w,d,N),r.Cartesian3.multiplyByScalar(o,.5,o),v.push(o.x,o.y,o.z),p=v.length/3-1,g[u]=p,h&&(s=n.Cartesian2.add(a,e,K),n.Cartesian2.multiplyByScalar(s,.5,s),c.push(s.x,s.y))),y.push(x,p,l),y.push(p,f,l)):(C.push(f),C.push(l),C.push(x))}let M={attributes:{position:new o.GeometryAttribute({componentDatatype:a.ComponentDatatype.DOUBLE,componentsPerAttribute:3,values:v})},indices:C,primitiveType:o.PrimitiveType.TRIANGLES};return h&&(M.attributes.st=new o.GeometryAttribute({componentDatatype:a.ComponentDatatype.FLOAT,componentsPerAttribute:2,values:c})),new o.Geometry(M)};let V=new r.Cartographic,k=new r.Cartographic,q=new r.Cartographic,j=new r.Cartographic;O.computeRhumbLineSubdivision=function(e,s,x,l,p){let h;p=i.defaultValue(p,t.CesiumMath.RADIANS_PER_DEGREE);let y=i.defined(l),f=x.slice(0),v=s.length,c=Array(3*v),d=Array(2*v),m=0,C=0;for(h=0;h<v;h++){let e=s[h];if(c[m++]=e.x,c[m++]=e.y,c[m++]=e.z,y){let e=l[h];d[C++]=e.x,d[C++]=e.y}}let g=[],b={},w=e.maximumRadius,A=t.CesiumMath.chordLength(p,w),M=new u.EllipsoidRhumbLine(void 0,void 0,e),S=new u.EllipsoidRhumbLine(void 0,void 0,e),E=new u.EllipsoidRhumbLine(void 0,void 0,e);for(;f.length>0;){let t,a,u,o,s,x,l,p;let v=f.pop(),m=f.pop(),C=f.pop(),w=r.Cartesian3.fromArray(c,3*C,T),Z=r.Cartesian3.fromArray(c,3*m,B),z=r.Cartesian3.fromArray(c,3*v,W);y&&(t=n.Cartesian2.fromArray(d,2*C,U),a=n.Cartesian2.fromArray(d,2*m,_),u=n.Cartesian2.fromArray(d,2*v,F));let D=e.cartesianToCartographic(w,V),L=e.cartesianToCartographic(Z,k),R=e.cartesianToCartographic(z,q);M.setEndPoints(D,L);let G=M.surfaceDistance;S.setEndPoints(L,R);let O=S.surfaceDistance;E.setEndPoints(R,D);let P=E.surfaceDistance,$=Math.max(G,O,P);$>A?G===$?(h=b[o=`${Math.min(C,m)} ${Math.max(C,m)}`],i.defined(h)||(s=M.interpolateUsingFraction(.5,j),x=.5*(D.height+L.height),l=r.Cartesian3.fromRadians(s.longitude,s.latitude,x,e,N),c.push(l.x,l.y,l.z),h=c.length/3-1,b[o]=h,y&&(p=n.Cartesian2.add(t,a,K),n.Cartesian2.multiplyByScalar(p,.5,p),d.push(p.x,p.y))),f.push(C,h,v),f.push(h,m,v)):O===$?(h=b[o=`${Math.min(m,v)} ${Math.max(m,v)}`],i.defined(h)||(s=S.interpolateUsingFraction(.5,j),x=.5*(L.height+R.height),l=r.Cartesian3.fromRadians(s.longitude,s.latitude,x,e,N),c.push(l.x,l.y,l.z),h=c.length/3-1,b[o]=h,y&&(p=n.Cartesian2.add(a,u,K),n.Cartesian2.multiplyByScalar(p,.5,p),d.push(p.x,p.y))),f.push(m,h,C),f.push(h,v,C)):P===$&&(h=b[o=`${Math.min(v,C)} ${Math.max(v,C)}`],i.defined(h)||(s=E.interpolateUsingFraction(.5,j),x=.5*(R.height+D.height),l=r.Cartesian3.fromRadians(s.longitude,s.latitude,x,e,N),c.push(l.x,l.y,l.z),h=c.length/3-1,b[o]=h,y&&(p=n.Cartesian2.add(u,t,K),n.Cartesian2.multiplyByScalar(p,.5,p),d.push(p.x,p.y))),f.push(v,h,m),f.push(h,C,m)):(g.push(C),g.push(m),g.push(v))}let Z={attributes:{position:new o.GeometryAttribute({componentDatatype:a.ComponentDatatype.DOUBLE,componentsPerAttribute:3,values:c})},indices:g,primitiveType:o.PrimitiveType.TRIANGLES};return y&&(Z.attributes.st=new o.GeometryAttribute({componentDatatype:a.ComponentDatatype.FLOAT,componentsPerAttribute:2,values:d})),new o.Geometry(Z)},O.scaleToGeodeticHeight=function(e,t,n,a){n=i.defaultValue(n,r.Ellipsoid.WGS84);let u=R,o=G;if(t=i.defaultValue(t,0),a=i.defaultValue(a,!0),i.defined(e)){let i=e.length;for(let s=0;s<i;s+=3)r.Cartesian3.fromArray(e,s,o),a&&(o=n.scaleToGeodeticSurface(o,o)),0!==t&&(u=n.geodeticSurfaceNormal(o,u),r.Cartesian3.multiplyByScalar(u,t,u),r.Cartesian3.add(o,u,o)),e[s]=o.x,e[s+1]=o.y,e[s+2]=o.z}return e},e.PolygonPipeline=O,e.WindingOrder=L});