define(["exports","./GeometryOffsetAttribute-1772960d","./Transforms-d13cc04e","./Matrix2-9aa31791","./ComponentDatatype-93750d1a","./when-4bbc8319","./RuntimeError-346a3079","./GeometryAttribute-43536dc0","./GeometryAttributes-7827a6c2","./IndexDatatype-b7d979a6","./VertexFormat-71718faa"],function(t,e,a,i,r,n,o,m,s,u,l){"use strict";var f=new i.Cartesian3,c=new i.Cartesian3,d=new i.Cartesian3,C=new i.Cartesian3,p=new i.Cartesian3,y=new i.Cartesian3(1,1,1),_=Math.cos,v=Math.sin;function h(t){t=n.defaultValue(t,n.defaultValue.EMPTY_OBJECT);var e=n.defaultValue(t.radii,y),a=n.defaultValue(t.innerRadii,e),o=n.defaultValue(t.minimumClock,0),m=n.defaultValue(t.maximumClock,r.CesiumMath.TWO_PI),s=n.defaultValue(t.minimumCone,0),u=n.defaultValue(t.maximumCone,r.CesiumMath.PI),f=Math.round(n.defaultValue(t.stackPartitions,64)),c=Math.round(n.defaultValue(t.slicePartitions,64)),d=n.defaultValue(t.vertexFormat,l.VertexFormat.DEFAULT);this._radii=i.Cartesian3.clone(e),this._innerRadii=i.Cartesian3.clone(a),this._minimumClock=o,this._maximumClock=m,this._minimumCone=s,this._maximumCone=u,this._stackPartitions=f,this._slicePartitions=c,this._vertexFormat=l.VertexFormat.clone(d),this._offsetAttribute=t.offsetAttribute,this._workerName="createEllipsoidGeometry"}h.packedLength=2*i.Cartesian3.packedLength+l.VertexFormat.packedLength+7,h.pack=function(t,e,a){return a=n.defaultValue(a,0),i.Cartesian3.pack(t._radii,e,a),a+=i.Cartesian3.packedLength,i.Cartesian3.pack(t._innerRadii,e,a),a+=i.Cartesian3.packedLength,l.VertexFormat.pack(t._vertexFormat,e,a),a+=l.VertexFormat.packedLength,e[a++]=t._minimumClock,e[a++]=t._maximumClock,e[a++]=t._minimumCone,e[a++]=t._maximumCone,e[a++]=t._stackPartitions,e[a++]=t._slicePartitions,e[a]=n.defaultValue(t._offsetAttribute,-1),e};var x,A=new i.Cartesian3,b=new i.Cartesian3,k=new l.VertexFormat,F={radii:A,innerRadii:b,vertexFormat:k,minimumClock:void 0,maximumClock:void 0,minimumCone:void 0,maximumCone:void 0,stackPartitions:void 0,slicePartitions:void 0,offsetAttribute:void 0};h.unpack=function(t,e,a){e=n.defaultValue(e,0);var r=i.Cartesian3.unpack(t,e,A);e+=i.Cartesian3.packedLength;var o=i.Cartesian3.unpack(t,e,b);e+=i.Cartesian3.packedLength;var m=l.VertexFormat.unpack(t,e,k);e+=l.VertexFormat.packedLength;var s=t[e++],u=t[e++],f=t[e++],c=t[e++],d=t[e++],C=t[e++],p=t[e];return n.defined(a)?(a._radii=i.Cartesian3.clone(r,a._radii),a._innerRadii=i.Cartesian3.clone(o,a._innerRadii),a._vertexFormat=l.VertexFormat.clone(m,a._vertexFormat),a._minimumClock=s,a._maximumClock=u,a._minimumCone=f,a._maximumCone=c,a._stackPartitions=d,a._slicePartitions=C,a._offsetAttribute=-1===p?void 0:p,a):(F.minimumClock=s,F.maximumClock=u,F.minimumCone=f,F.maximumCone=c,F.stackPartitions=d,F.slicePartitions=C,F.offsetAttribute=-1===p?void 0:p,new h(F))},h.createGeometry=function(t){var o=t._radii;if(!(o.x<=0||o.y<=0||o.z<=0)){var l=t._innerRadii;if(!(l.x<=0||l.y<=0||l.z<=0)){var y,h,x=t._minimumClock,A=t._maximumClock,b=t._minimumCone,k=t._maximumCone,F=t._vertexFormat,P=t._slicePartitions+1,g=t._stackPartitions+1;(P=Math.round(P*Math.abs(A-x)/r.CesiumMath.TWO_PI))<2&&(P=2),(g=Math.round(g*Math.abs(k-b)/r.CesiumMath.PI))<2&&(g=2);var w=0,V=[b],M=[x];for(y=0;y<g;y++)V.push(b+y*(k-b)/(g-1));for(V.push(k),h=0;h<P;h++)M.push(x+h*(A-x)/(P-1));M.push(A);var T=V.length,D=M.length,G=0,L=1,O=l.x!==o.x||l.y!==o.y||l.z!==o.z,I=!1,E=!1,z=!1;O&&(L=2,b>0&&(I=!0,G+=P-1),k<Math.PI&&(E=!0,G+=P-1),(A-x)%r.CesiumMath.TWO_PI?(z=!0,G+=2*(g-1)+1):G+=1);var N=D*T*L,R=new Float64Array(3*N),U=e.arrayFill(Array(N),!1),S=e.arrayFill(Array(N),!1),B=P*g*L,W=6*(B+G+1-(P+g)*L),Y=u.IndexDatatype.createTypedArray(B,W),J=F.normal?new Float32Array(3*N):void 0,X=F.tangent?new Float32Array(3*N):void 0,Z=F.bitangent?new Float32Array(3*N):void 0,j=F.st?new Float32Array(2*N):void 0,q=Array(T),H=Array(T);for(y=0;y<T;y++)q[y]=v(V[y]),H[y]=_(V[y]);var K=Array(D),Q=Array(D);for(h=0;h<D;h++)Q[h]=_(M[h]),K[h]=v(M[h]);for(y=0;y<T;y++)for(h=0;h<D;h++)R[w++]=o.x*q[y]*Q[h],R[w++]=o.y*q[y]*K[h],R[w++]=o.z*H[y];var $,tt,te,ta,ti=N/2;if(O)for(y=0;y<T;y++)for(h=0;h<D;h++)R[w++]=l.x*q[y]*Q[h],R[w++]=l.y*q[y]*K[h],R[w++]=l.z*H[y],U[ti]=!0,y>0&&y!==T-1&&0!==h&&h!==D-1&&(S[ti]=!0),ti++;for(w=0,y=1;y<T-2;y++)for($=y*D,tt=(y+1)*D,h=1;h<D-2;h++)Y[w++]=tt+h,Y[w++]=tt+h+1,Y[w++]=$+h+1,Y[w++]=tt+h,Y[w++]=$+h+1,Y[w++]=$+h;if(O){var tr=T*D;for(y=1;y<T-2;y++)for($=tr+y*D,tt=tr+(y+1)*D,h=1;h<D-2;h++)Y[w++]=tt+h,Y[w++]=$+h,Y[w++]=$+h+1,Y[w++]=tt+h,Y[w++]=$+h+1,Y[w++]=tt+h+1}if(O){if(I)for(ta=T*D,y=1;y<D-2;y++)Y[w++]=y,Y[w++]=y+1,Y[w++]=ta+y+1,Y[w++]=y,Y[w++]=ta+y+1,Y[w++]=ta+y;if(E)for(te=T*D-D,ta=T*D*L-D,y=1;y<D-2;y++)Y[w++]=te+y+1,Y[w++]=te+y,Y[w++]=ta+y,Y[w++]=te+y+1,Y[w++]=ta+y,Y[w++]=ta+y+1}if(z){for(y=1;y<T-2;y++)ta=D*T+D*y,te=D*y,Y[w++]=ta,Y[w++]=te+D,Y[w++]=te,Y[w++]=ta,Y[w++]=ta+D,Y[w++]=te+D;for(y=1;y<T-2;y++)ta=D*T+D*(y+1)-1,te=D*(y+1)-1,Y[w++]=te+D,Y[w++]=ta,Y[w++]=te,Y[w++]=te+D,Y[w++]=ta+D,Y[w++]=ta}var tn=new s.GeometryAttributes;F.position&&(tn.position=new m.GeometryAttribute({componentDatatype:r.ComponentDatatype.DOUBLE,componentsPerAttribute:3,values:R}));var to,tm=0,ts=0,tu=0,tl=0,tf=N/2,tc=i.Ellipsoid.fromCartesian3(o),td=i.Ellipsoid.fromCartesian3(l);if(F.st||F.normal||F.tangent||F.bitangent){for(y=0;y<N;y++){to=U[y]?td:tc;var tC=i.Cartesian3.fromArray(R,3*y,f),tp=to.geodeticSurfaceNormal(tC,c);if(S[y]&&i.Cartesian3.negate(tp,tp),F.st){var ty=i.Cartesian2.negate(tp,p);j[tm++]=Math.atan2(ty.y,ty.x)/r.CesiumMath.TWO_PI+.5,j[tm++]=Math.asin(tp.z)/Math.PI+.5}if(F.normal&&(J[ts++]=tp.x,J[ts++]=tp.y,J[ts++]=tp.z),F.tangent||F.bitangent){var t_,tv=0;if(U[y]&&(tv=tf),t_=!I&&y>=tv&&y<tv+2*D?i.Cartesian3.UNIT_X:i.Cartesian3.UNIT_Z,i.Cartesian3.cross(t_,tp,d),i.Cartesian3.normalize(d,d),F.tangent&&(X[tu++]=d.x,X[tu++]=d.y,X[tu++]=d.z),F.bitangent){var th=i.Cartesian3.cross(tp,d,C);i.Cartesian3.normalize(th,th),Z[tl++]=th.x,Z[tl++]=th.y,Z[tl++]=th.z}}}F.st&&(tn.st=new m.GeometryAttribute({componentDatatype:r.ComponentDatatype.FLOAT,componentsPerAttribute:2,values:j})),F.normal&&(tn.normal=new m.GeometryAttribute({componentDatatype:r.ComponentDatatype.FLOAT,componentsPerAttribute:3,values:J})),F.tangent&&(tn.tangent=new m.GeometryAttribute({componentDatatype:r.ComponentDatatype.FLOAT,componentsPerAttribute:3,values:X})),F.bitangent&&(tn.bitangent=new m.GeometryAttribute({componentDatatype:r.ComponentDatatype.FLOAT,componentsPerAttribute:3,values:Z}))}if(n.defined(t._offsetAttribute)){var tx=R.length,tA=new Uint8Array(tx/3),tb=t._offsetAttribute===e.GeometryOffsetAttribute.NONE?0:1;e.arrayFill(tA,tb),tn.applyOffset=new m.GeometryAttribute({componentDatatype:r.ComponentDatatype.UNSIGNED_BYTE,componentsPerAttribute:1,values:tA})}return new m.Geometry({attributes:tn,indices:Y,primitiveType:m.PrimitiveType.TRIANGLES,boundingSphere:a.BoundingSphere.fromEllipsoid(tc),offsetAttribute:t._offsetAttribute})}}},h.getUnitEllipsoid=function(){return n.defined(x)||(x=h.createGeometry(new h({radii:new i.Cartesian3(1,1,1),vertexFormat:l.VertexFormat.POSITION_ONLY}))),x},t.EllipsoidGeometry=h});