define(["exports","./AttributeCompression-af389d04","./Matrix2-9aa31791","./RuntimeError-346a3079","./when-4bbc8319","./ComponentDatatype-93750d1a","./Transforms-d13cc04e","./EncodedCartesian3-f286cedc","./GeometryAttribute-43536dc0","./IndexDatatype-b7d979a6","./IntersectionTests-96a04219","./Plane-318d6937"],function(e,t,r,a,i,n,s,o,u,p,d,l){"use strict";var y=new r.Cartesian3,v=new r.Cartesian3,f=new r.Cartesian3,m={calculateACMR:function(e){var t=(e=i.defaultValue(e,i.defaultValue.EMPTY_OBJECT)).indices,r=e.maximumIndex,a=i.defaultValue(e.cacheSize,24),n=t.length;if(!i.defined(r)){r=0;for(var s=0,o=t[s];s<n;)o>r&&(r=o),o=t[++s]}for(var u=[],p=0;p<r+1;p++)u[p]=0;for(var d=a+1,l=0;l<n;++l)d-u[t[l]]>a&&(u[t[l]]=d,++d);return(d-a+1)/(n/3)}};m.tipsify=function(e){var t,r=(e=i.defaultValue(e,i.defaultValue.EMPTY_OBJECT)).indices,a=e.maximumIndex,n=i.defaultValue(e.cacheSize,24),s=r.length,o=0,u=0,p=r[0];if(i.defined(a))o=a+1;else{for(;u<s;)p>o&&(o=p),p=r[++u];if(-1===o)return 0;++o}var d,l=[];for(d=0;d<o;d++)l[d]={numLiveTriangles:0,timeStamp:0,vertexTriangles:[]};u=0;for(var y=0;u<s;)l[r[u]].vertexTriangles.push(y),++l[r[u]].numLiveTriangles,l[r[u+1]].vertexTriangles.push(y),++l[r[u+1]].numLiveTriangles,l[r[u+2]].vertexTriangles.push(y),++l[r[u+2]].numLiveTriangles,++y,u+=3;var v=0,f=n+1;t=1;var m,c,C,h,b=[],g=[],A=0,T=[],x=s/3,P=[];for(d=0;d<x;d++)P[d]=!1;for(;-1!==v;){b=[],h=(c=l[v]).vertexTriangles.length;for(var w=0;w<h;++w)if(!P[y=c.vertexTriangles[w]]){P[y]=!0,u=y+y+y;for(var S=0;S<3;++S)C=r[u],b.push(C),g.push(C),T[A]=C,++A,--(m=l[C]).numLiveTriangles,f-m.timeStamp>n&&(m.timeStamp=f,++f),++u}v=function(e,r,a,i,n,s,o){for(var u,p=-1,d=-1,l=0;l<a.length;){var y=a[l];i[y].numLiveTriangles&&(u=0,n-i[y].timeStamp+2*i[y].numLiveTriangles<=r&&(u=n-i[y].timeStamp),(u>d||-1===d)&&(d=u,p=y)),++l}return -1===p?function(e,r,a,i){for(;r.length>=1;){var n=r[r.length-1];if(r.splice(r.length-1,1),e[n].numLiveTriangles>0)return n}for(;t<i;){if(e[t].numLiveTriangles>0)return++t-1;++t}return -1}(i,s,0,o):p}(0,n,b,l,f,g,o)}return T};var c={};function C(e,t,r,a,i){e[t++]=r,e[t++]=a,e[t++]=a,e[t++]=i,e[t++]=i,e[t]=r}function h(e){var t={};for(var r in e)if(e.hasOwnProperty(r)&&i.defined(e[r])&&i.defined(e[r].values)){var a=e[r];t[r]=new u.GeometryAttribute({componentDatatype:a.componentDatatype,componentsPerAttribute:a.componentsPerAttribute,normalize:a.normalize,values:[]})}return t}c.toWireframe=function(e){var t=e.indices;if(i.defined(t)){switch(e.primitiveType){case u.PrimitiveType.TRIANGLES:e.indices=function(e){for(var t=e.length,r=t/3*6,a=p.IndexDatatype.createTypedArray(t,r),i=0,n=0;n<t;n+=3,i+=6)C(a,i,e[n],e[n+1],e[n+2]);return a}(t);break;case u.PrimitiveType.TRIANGLE_STRIP:e.indices=function(e){var t=e.length;if(t>=3){var r=6*(t-2),a=p.IndexDatatype.createTypedArray(t,r);C(a,0,e[0],e[1],e[2]);for(var i=6,n=3;n<t;++n,i+=6)C(a,i,e[n-1],e[n],e[n-2]);return a}return new Uint16Array}(t);break;case u.PrimitiveType.TRIANGLE_FAN:e.indices=function(e){if(e.length>0){for(var t=e.length-1,r=6*(t-1),a=p.IndexDatatype.createTypedArray(t,r),i=e[0],n=0,s=1;s<t;++s,n+=6)C(a,n,i,e[s],e[s+1]);return a}return new Uint16Array}(t)}e.primitiveType=u.PrimitiveType.LINES}return e},c.createLineSegmentsForVectors=function(e,t,r){t=i.defaultValue(t,"normal"),r=i.defaultValue(r,1e4);for(var a,o=e.attributes.position.values,p=e.attributes[t].values,d=o.length,l=new Float64Array(2*d),y=0,v=0;v<d;v+=3)l[y++]=o[v],l[y++]=o[v+1],l[y++]=o[v+2],l[y++]=o[v]+p[v]*r,l[y++]=o[v+1]+p[v+1]*r,l[y++]=o[v+2]+p[v+2]*r;var f=e.boundingSphere;return i.defined(f)&&(a=new s.BoundingSphere(f.center,f.radius+r)),new u.Geometry({attributes:{position:new u.GeometryAttribute({componentDatatype:n.ComponentDatatype.DOUBLE,componentsPerAttribute:3,values:l})},primitiveType:u.PrimitiveType.LINES,boundingSphere:a})},c.createAttributeLocations=function(e){var t,r=["position","positionHigh","positionLow","position3DHigh","position3DLow","position2DHigh","position2DLow","pickColor","normal","st","tangent","bitangent","extrudeDirection","compressedAttributes"],a=e.attributes,n={},s=0,o=r.length;for(t=0;t<o;++t){var u=r[t];i.defined(a[u])&&(n[u]=s++)}for(var p in a)a.hasOwnProperty(p)&&!i.defined(n[p])&&(n[p]=s++);return n},c.reorderForPreVertexCache=function(e){var t=u.Geometry.computeNumberOfVertices(e),r=e.indices;if(i.defined(r)){for(var a=new Int32Array(t),s=0;s<t;s++)a[s]=-1;for(var o,d=r.length,l=p.IndexDatatype.createTypedArray(t,d),y=0,v=0,f=0;y<d;)-1!==(o=a[r[y]])?l[v]=o:(a[o=r[y]]=f,l[v]=f,++f),++y,++v;e.indices=l;var m=e.attributes;for(var c in m)if(m.hasOwnProperty(c)&&i.defined(m[c])&&i.defined(m[c].values)){for(var C=m[c],h=C.values,b=0,g=C.componentsPerAttribute,A=n.ComponentDatatype.createTypedArray(C.componentDatatype,f*g);b<t;){var T=a[b];if(-1!==T)for(var x=0;x<g;x++)A[g*T+x]=h[g*b+x];++b}C.values=A}}return e},c.reorderForPostVertexCache=function(e,t){var r=e.indices;if(e.primitiveType===u.PrimitiveType.TRIANGLES&&i.defined(r)){for(var a=r.length,n=0,s=0;s<a;s++)r[s]>n&&(n=r[s]);e.indices=m.tipsify({indices:r,maximumIndex:n,cacheSize:t})}return e},c.fitToUnsignedShortIndices=function(e){var t=[],r=u.Geometry.computeNumberOfVertices(e);if(i.defined(e.indices)&&r>=n.CesiumMath.SIXTY_FOUR_KILOBYTES){var a,s=[],o=[],p=0,d=h(e.attributes),l=e.indices,y=l.length;e.primitiveType===u.PrimitiveType.TRIANGLES?a=3:e.primitiveType===u.PrimitiveType.LINES?a=2:e.primitiveType===u.PrimitiveType.POINTS&&(a=1);for(var v=0;v<y;v+=a){for(var f=0;f<a;++f){var m=l[v+f],c=s[m];i.defined(c)||(c=p++,s[m]=c,function(e,t,r){for(var a in t)if(t.hasOwnProperty(a)&&i.defined(t[a])&&i.defined(t[a].values))for(var n=t[a],s=0;s<n.componentsPerAttribute;++s)e[a].values.push(n.values[r*n.componentsPerAttribute+s])}(d,e.attributes,m)),o.push(c)}p+a>=n.CesiumMath.SIXTY_FOUR_KILOBYTES&&(t.push(new u.Geometry({attributes:d,indices:o,primitiveType:e.primitiveType,boundingSphere:e.boundingSphere,boundingSphereCV:e.boundingSphereCV})),s=[],o=[],p=0,d=h(e.attributes))}0!==o.length&&t.push(new u.Geometry({attributes:d,indices:o,primitiveType:e.primitiveType,boundingSphere:e.boundingSphere,boundingSphereCV:e.boundingSphereCV}))}else t.push(e);return t};var b=new r.Cartesian3,g=new r.Cartographic;c.projectTo2D=function(e,t,a,o,p){for(var d=e.attributes[t],l=(p=i.defined(p)?p:new s.GeographicProjection).ellipsoid,y=d.values,v=new Float64Array(y.length),f=0,m=0;m<y.length;m+=3){var c=r.Cartesian3.fromArray(y,m,b),C=l.cartesianToCartographic(c,g),h=p.project(C,b);v[f++]=h.x,v[f++]=h.y,v[f++]=h.z}return e.attributes[a]=d,e.attributes[o]=new u.GeometryAttribute({componentDatatype:n.ComponentDatatype.DOUBLE,componentsPerAttribute:3,values:v}),delete e.attributes[t],e};var A={high:0,low:0};c.encodeAttribute=function(e,t,r,a){for(var i=e.attributes[t],s=i.values,p=s.length,d=new Float32Array(p),l=new Float32Array(p),y=0;y<p;++y)o.EncodedCartesian3.encode(s[y],A),d[y]=A.high,l[y]=A.low;var v=i.componentsPerAttribute;return e.attributes[r]=new u.GeometryAttribute({componentDatatype:n.ComponentDatatype.FLOAT,componentsPerAttribute:v,values:d}),e.attributes[a]=new u.GeometryAttribute({componentDatatype:n.ComponentDatatype.FLOAT,componentsPerAttribute:v,values:l}),delete e.attributes[t],e};var T=new r.Cartesian3;function x(e,t){if(i.defined(t))for(var a=t.values,n=a.length,s=0;s<n;s+=3)r.Cartesian3.unpack(a,s,T),r.Matrix4.multiplyByPoint(e,T,T),r.Cartesian3.pack(T,a,s)}function P(e,t){if(i.defined(t))for(var a=t.values,n=a.length,s=0;s<n;s+=3)r.Cartesian3.unpack(a,s,T),r.Matrix3.multiplyByVector(e,T,T),T=r.Cartesian3.normalize(T,T),r.Cartesian3.pack(T,a,s)}var w=new r.Matrix4,S=new r.Matrix3;c.transformToWorldCoordinates=function(e){var t=e.modelMatrix;if(r.Matrix4.equals(t,r.Matrix4.IDENTITY))return e;var a=e.geometry.attributes;x(t,a.position),x(t,a.prevPosition),x(t,a.nextPosition),(i.defined(a.normal)||i.defined(a.tangent)||i.defined(a.bitangent))&&(r.Matrix4.inverse(t,w),r.Matrix4.transpose(w,w),r.Matrix4.getMatrix3(w,S),P(S,a.normal),P(S,a.tangent),P(S,a.bitangent));var n=e.geometry.boundingSphere;return i.defined(n)&&(e.geometry.boundingSphere=s.BoundingSphere.transform(n,t,n)),e.modelMatrix=r.Matrix4.clone(r.Matrix4.IDENTITY),e};var I=new r.Cartesian3;function O(e,t){var a,o,d,l,y=e.length;e[0].modelMatrix;var v,f,m,c,C=i.defined(e[0][t].indices),h=e[0][t].primitiveType,b=function(e,t){var r,a=e.length,s={},o=e[0][t].attributes;for(r in o)if(o.hasOwnProperty(r)&&i.defined(o[r])&&i.defined(o[r].values)){for(var p=o[r],d=p.values.length,l=!0,y=1;y<a;++y){var v=e[y][t].attributes[r];if(!i.defined(v)||p.componentDatatype!==v.componentDatatype||p.componentsPerAttribute!==v.componentsPerAttribute||p.normalize!==v.normalize){l=!1;break}d+=v.values.length}l&&(s[r]=new u.GeometryAttribute({componentDatatype:p.componentDatatype,componentsPerAttribute:p.componentsPerAttribute,normalize:p.normalize,values:n.ComponentDatatype.createTypedArray(p.componentDatatype,d)}))}return s}(e,t);for(a in b)if(b.hasOwnProperty(a))for(v=b[a].values,l=0,o=0;o<y;++o)for(m=(f=e[o][t].attributes[a].values).length,d=0;d<m;++d)v[l++]=f[d];if(C){var g=0;for(o=0;o<y;++o)g+=e[o][t].indices.length;var A=u.Geometry.computeNumberOfVertices(new u.Geometry({attributes:b,primitiveType:u.PrimitiveType.POINTS})),T=p.IndexDatatype.createTypedArray(A,g),x=0,P=0;for(o=0;o<y;++o){var w=e[o][t].indices,S=w.length;for(l=0;l<S;++l)T[x++]=P+w[l];P+=u.Geometry.computeNumberOfVertices(e[o][t])}c=T}var O,E=new r.Cartesian3,N=0;for(o=0;o<y;++o){if(O=e[o][t].boundingSphere,!i.defined(O)){E=void 0;break}r.Cartesian3.add(O.center,E,E)}if(i.defined(E))for(r.Cartesian3.divideByScalar(E,y,E),o=0;o<y;++o){O=e[o][t].boundingSphere;var L=r.Cartesian3.magnitude(r.Cartesian3.subtract(O.center,E,I))+O.radius;L>N&&(N=L)}return new u.Geometry({attributes:b,indices:c,primitiveType:h,boundingSphere:i.defined(E)?new s.BoundingSphere(E,N):void 0})}c.combineInstances=function(e){for(var t=[],r=[],a=e.length,n=0;n<a;++n){var s=e[n];i.defined(s.geometry)?t.push(s):i.defined(s.westHemisphereGeometry)&&i.defined(s.eastHemisphereGeometry)&&r.push(s)}var o=[];return t.length>0&&o.push(O(t,"geometry")),r.length>0&&(o.push(O(r,"westHemisphereGeometry")),o.push(O(r,"eastHemisphereGeometry"))),o};var E=new r.Cartesian3,N=new r.Cartesian3,L=new r.Cartesian3,z=new r.Cartesian3;c.computeNormal=function(e){var t,a=e.indices,i=e.attributes,s=i.position.values,o=i.position.values.length/3,p=a.length,d=Array(o),l=Array(p/3),y=Array(p);for(t=0;t<o;t++)d[t]={indexOffset:0,count:0,currentCount:0};var v=0;for(t=0;t<p;t+=3){var f=a[t],m=a[t+1],c=a[t+2],C=3*f,h=3*m,b=3*c;N.x=s[C],N.y=s[C+1],N.z=s[C+2],L.x=s[h],L.y=s[h+1],L.z=s[h+2],z.x=s[b],z.y=s[b+1],z.z=s[b+2],d[f].count++,d[m].count++,d[c].count++,r.Cartesian3.subtract(L,N,L),r.Cartesian3.subtract(z,N,z),l[v]=r.Cartesian3.cross(L,z,new r.Cartesian3),v++}var g,A=0;for(t=0;t<o;t++)d[t].indexOffset+=A,A+=d[t].count;for(v=0,t=0;t<p;t+=3){var T=(g=d[a[t]]).indexOffset+g.currentCount;y[T]=v,g.currentCount++,y[T=(g=d[a[t+1]]).indexOffset+g.currentCount]=v,g.currentCount++,y[T=(g=d[a[t+2]]).indexOffset+g.currentCount]=v,g.currentCount++,v++}var x=new Float32Array(3*o);for(t=0;t<o;t++){var P=3*t;if(g=d[t],r.Cartesian3.clone(r.Cartesian3.ZERO,E),g.count>0){for(v=0;v<g.count;v++)r.Cartesian3.add(E,l[y[g.indexOffset+v]],E);r.Cartesian3.equalsEpsilon(r.Cartesian3.ZERO,E,n.CesiumMath.EPSILON10)&&r.Cartesian3.clone(l[y[g.indexOffset]],E)}r.Cartesian3.equalsEpsilon(r.Cartesian3.ZERO,E,n.CesiumMath.EPSILON10)&&(E.z=1),r.Cartesian3.normalize(E,E),x[P]=E.x,x[P+1]=E.y,x[P+2]=E.z}return e.attributes.normal=new u.GeometryAttribute({componentDatatype:n.ComponentDatatype.FLOAT,componentsPerAttribute:3,values:x}),e};var D=new r.Cartesian3,M=new r.Cartesian3,G=new r.Cartesian3;c.computeTangentAndBitangent=function(e){e.attributes;var t,a,i,s,o=e.indices,p=e.attributes.position.values,d=e.attributes.normal.values,l=e.attributes.st.values,y=e.attributes.position.values.length/3,v=o.length,f=Array(3*y);for(t=0;t<f.length;t++)f[t]=0;for(t=0;t<v;t+=3){var m=o[t],c=o[t+1],C=o[t+2];i=3*c,s=3*C;var h=2*m,b=2*c,g=2*C,A=p[a=3*m],T=p[a+1],x=p[a+2],P=l[h],w=l[h+1],S=l[b+1]-w,I=l[g+1]-w,O=1/((l[b]-P)*I-(l[g]-P)*S),E=(I*(p[i]-A)-S*(p[s]-A))*O,N=(I*(p[i+1]-T)-S*(p[s+1]-T))*O,L=(I*(p[i+2]-x)-S*(p[s+2]-x))*O;f[a]+=E,f[a+1]+=N,f[a+2]+=L,f[i]+=E,f[i+1]+=N,f[i+2]+=L,f[s]+=E,f[s+1]+=N,f[s+2]+=L}var z=new Float32Array(3*y),R=new Float32Array(3*y);for(t=0;t<y;t++){i=(a=3*t)+1,s=a+2;var V=r.Cartesian3.fromArray(d,a,D),F=r.Cartesian3.fromArray(f,a,G),B=r.Cartesian3.dot(V,F);r.Cartesian3.multiplyByScalar(V,B,M),r.Cartesian3.normalize(r.Cartesian3.subtract(F,M,F),F),z[a]=F.x,z[i]=F.y,z[s]=F.z,r.Cartesian3.normalize(r.Cartesian3.cross(V,F,F),F),R[a]=F.x,R[i]=F.y,R[s]=F.z}return e.attributes.tangent=new u.GeometryAttribute({componentDatatype:n.ComponentDatatype.FLOAT,componentsPerAttribute:3,values:z}),e.attributes.bitangent=new u.GeometryAttribute({componentDatatype:n.ComponentDatatype.FLOAT,componentsPerAttribute:3,values:R}),e};var R=new r.Cartesian2,V=new r.Cartesian3,F=new r.Cartesian3,B=new r.Cartesian3,_=new r.Cartesian2;function k(e,t){Math.abs(e.y)<n.CesiumMath.EPSILON6&&(e.y=t?-n.CesiumMath.EPSILON6:n.CesiumMath.EPSILON6)}c.compressVertices=function(e){var a,s,o=e.attributes.extrudeDirection;if(i.defined(o)){var p=o.values;s=p.length/3;var d=new Float32Array(2*s),l=0;for(a=0;a<s;++a)r.Cartesian3.fromArray(p,3*a,V),r.Cartesian3.equals(V,r.Cartesian3.ZERO)?l+=2:(_=t.AttributeCompression.octEncodeInRange(V,65535,_),d[l++]=_.x,d[l++]=_.y);return e.attributes.compressedAttributes=new u.GeometryAttribute({componentDatatype:n.ComponentDatatype.FLOAT,componentsPerAttribute:2,values:d}),delete e.attributes.extrudeDirection,e}var y=e.attributes.normal,v=e.attributes.st,f=i.defined(y),m=i.defined(v);if(!f&&!m)return e;var c,C,h,b,g=e.attributes.tangent,A=e.attributes.bitangent,T=i.defined(g),x=i.defined(A);f&&(c=y.values),m&&(C=v.values),T&&(h=g.values),x&&(b=A.values);var P=s=(f?c.length:C.length)/(f?3:2),w=m&&f?2:1;w+=T||x?1:0;var S=new Float32Array(P*=w),I=0;for(a=0;a<s;++a){m&&(r.Cartesian2.fromArray(C,2*a,R),S[I++]=t.AttributeCompression.compressTextureCoordinates(R));var O=3*a;f&&i.defined(h)&&i.defined(b)?(r.Cartesian3.fromArray(c,O,V),r.Cartesian3.fromArray(h,O,F),r.Cartesian3.fromArray(b,O,B),t.AttributeCompression.octPack(V,F,B,R),S[I++]=R.x,S[I++]=R.y):(f&&(r.Cartesian3.fromArray(c,O,V),S[I++]=t.AttributeCompression.octEncodeFloat(V)),T&&(r.Cartesian3.fromArray(h,O,V),S[I++]=t.AttributeCompression.octEncodeFloat(V)),x&&(r.Cartesian3.fromArray(b,O,V),S[I++]=t.AttributeCompression.octEncodeFloat(V)))}return e.attributes.compressedAttributes=new u.GeometryAttribute({componentDatatype:n.ComponentDatatype.FLOAT,componentsPerAttribute:w,values:S}),f&&delete e.attributes.normal,m&&delete e.attributes.st,x&&delete e.attributes.bitangent,T&&delete e.attributes.tangent,e};var q=new r.Cartesian3;function U(e,t,a,i){r.Cartesian3.add(e,r.Cartesian3.multiplyByScalar(r.Cartesian3.subtract(t,e,q),e.y/(e.y-t.y),q),a),r.Cartesian3.clone(a,i),k(a,!0),k(i,!1)}var Y=new r.Cartesian3,Z=new r.Cartesian3,H=new r.Cartesian3,W=new r.Cartesian3,X={positions:Array(7),indices:Array(9)};function j(e,t){var r=e.attributes;if(0!==r.position.values.length){for(var a in r)if(r.hasOwnProperty(a)&&i.defined(r[a])&&i.defined(r[a].values)){var o=r[a];o.values=n.ComponentDatatype.createTypedArray(o.componentDatatype,o.values)}var d=u.Geometry.computeNumberOfVertices(e);return e.indices=p.IndexDatatype.createTypedArray(d,e.indices),t&&(e.boundingSphere=s.BoundingSphere.fromVertices(r.position.values)),e}}function J(e){var t=e.attributes,r={};for(var a in t)if(t.hasOwnProperty(a)&&i.defined(t[a])&&i.defined(t[a].values)){var n=t[a];r[a]=new u.GeometryAttribute({componentDatatype:n.componentDatatype,componentsPerAttribute:n.componentsPerAttribute,normalize:n.normalize,values:[]})}return new u.Geometry({attributes:r,indices:[],primitiveType:e.primitiveType})}function K(e,t,r){var a=i.defined(e.geometry.boundingSphere);t=j(t,a),r=j(r,a),i.defined(r)&&!i.defined(t)?e.geometry=r:!i.defined(r)&&i.defined(t)?e.geometry=t:(e.westHemisphereGeometry=t,e.eastHemisphereGeometry=r,e.geometry=void 0)}function Q(e,t){var r=new e,a=new e,i=new e;return function(n,s,o,u,p,d,l,y){var v=e.fromArray(p,n*t,r),f=e.fromArray(p,s*t,a),m=e.fromArray(p,o*t,i);e.multiplyByScalar(v,u.x,v),e.multiplyByScalar(f,u.y,f),e.multiplyByScalar(m,u.z,m);var c=e.add(v,f,v);e.add(c,m,c),y&&e.normalize(c,c),e.pack(c,d,l*t)}}var $=Q(r.Cartesian4,4),ee=Q(r.Cartesian3,3),et=Q(r.Cartesian2,2),er=new r.Cartesian3,ea=new r.Cartesian3,ei=new r.Cartesian3,en=new r.Cartesian3;function es(e,t,a,s,o,u,p,d,l,m,c,C,h,b,g,A){if(i.defined(u)||i.defined(p)||i.defined(d)||i.defined(l)||i.defined(m)||0!==b){var T,x,P,w,S=function(e,t,a,s,o){if(i.defined(o)||(o=new r.Cartesian3),i.defined(t.z)){if(r.Cartesian3.equalsEpsilon(e,t,n.CesiumMath.EPSILON14))return r.Cartesian3.clone(r.Cartesian3.UNIT_X,o);if(r.Cartesian3.equalsEpsilon(e,a,n.CesiumMath.EPSILON14))return r.Cartesian3.clone(r.Cartesian3.UNIT_Y,o);if(r.Cartesian3.equalsEpsilon(e,s,n.CesiumMath.EPSILON14))return r.Cartesian3.clone(r.Cartesian3.UNIT_Z,o);u=r.Cartesian3.subtract(a,t,y),p=r.Cartesian3.subtract(s,t,v),d=r.Cartesian3.subtract(e,t,f),l=r.Cartesian3.dot(u,u),m=r.Cartesian3.dot(u,p),c=r.Cartesian3.dot(u,d),C=r.Cartesian3.dot(p,p),h=r.Cartesian3.dot(p,d)}else{if(r.Cartesian2.equalsEpsilon(e,t,n.CesiumMath.EPSILON14))return r.Cartesian3.clone(r.Cartesian3.UNIT_X,o);if(r.Cartesian2.equalsEpsilon(e,a,n.CesiumMath.EPSILON14))return r.Cartesian3.clone(r.Cartesian3.UNIT_Y,o);if(r.Cartesian2.equalsEpsilon(e,s,n.CesiumMath.EPSILON14))return r.Cartesian3.clone(r.Cartesian3.UNIT_Z,o);u=r.Cartesian2.subtract(a,t,y),p=r.Cartesian2.subtract(s,t,v),d=r.Cartesian2.subtract(e,t,f),l=r.Cartesian2.dot(u,u),m=r.Cartesian2.dot(u,p),c=r.Cartesian2.dot(u,d),C=r.Cartesian2.dot(p,p),h=r.Cartesian2.dot(p,d)}o.y=C*c-m*h,o.z=l*h-m*c;var u,p,d,l,m,c,C,h,b=l*C-m*m;return 0!==o.y&&(o.y/=b),0!==o.z&&(o.z/=b),o.x=1-o.y-o.z,o}(s,r.Cartesian3.fromArray(o,3*e,er),r.Cartesian3.fromArray(o,3*t,ea),r.Cartesian3.fromArray(o,3*a,ei),en);if(i.defined(u)&&ee(e,t,a,S,u,C.normal.values,A,!0),i.defined(m)){var I,O=r.Cartesian3.fromArray(m,3*e,er),E=r.Cartesian3.fromArray(m,3*t,ea),N=r.Cartesian3.fromArray(m,3*a,ei);r.Cartesian3.multiplyByScalar(O,S.x,O),r.Cartesian3.multiplyByScalar(E,S.y,E),r.Cartesian3.multiplyByScalar(N,S.z,N),r.Cartesian3.equals(O,r.Cartesian3.ZERO)&&r.Cartesian3.equals(E,r.Cartesian3.ZERO)&&r.Cartesian3.equals(N,r.Cartesian3.ZERO)?((I=er).x=0,I.y=0,I.z=0):(I=r.Cartesian3.add(O,E,O),r.Cartesian3.add(I,N,I),r.Cartesian3.normalize(I,I)),r.Cartesian3.pack(I,C.extrudeDirection.values,3*A)}if(i.defined(c)&&(T=C.applyOffset.values,x=c[e]*S.x,P=c[t]*S.y,w=c[a]*S.z,T[A]=x+P+w>n.CesiumMath.EPSILON6?1:0),i.defined(p)&&ee(e,t,a,S,p,C.tangent.values,A,!0),i.defined(d)&&ee(e,t,a,S,d,C.bitangent.values,A,!0),i.defined(l)&&et(e,t,a,S,l,C.st.values,A),b>0)for(var L=0;L<b;L++){var z=h[L];!function(e,t,r,a,i,n,s){var o=n.componentsPerAttribute,u=n.values,p=s.values;switch(o){case 4:$(e,t,r,a,u,p,i,!1);break;case 3:ee(e,t,r,a,u,p,i,!1);break;case 2:et(e,t,r,a,u,p,i,!1);break;default:p[i]=u[e]*a.x+u[t]*a.y+u[r]*a.z}}(e,t,a,S,A,g[z],C[z])}}}function eo(e,t,r,a,i,n){var s=e.position.values.length/3;if(-1!==i){var o=a[i],u=r[o];return -1===u?(r[o]=s,e.position.values.push(n.x,n.y,n.z),t.push(s),s):(t.push(u),u)}return e.position.values.push(n.x,n.y,n.z),t.push(s),s}var eu={position:!0,normal:!0,bitangent:!0,tangent:!0,st:!0,extrudeDirection:!0,applyOffset:!0};function ep(e){var t=e.geometry,a=t.attributes,s=a.position.values,o=i.defined(a.normal)?a.normal.values:void 0,u=i.defined(a.bitangent)?a.bitangent.values:void 0,p=i.defined(a.tangent)?a.tangent.values:void 0,d=i.defined(a.st)?a.st.values:void 0,l=i.defined(a.extrudeDirection)?a.extrudeDirection.values:void 0,y=i.defined(a.applyOffset)?a.applyOffset.values:void 0,v=t.indices,f=[];for(var m in a)a.hasOwnProperty(m)&&!eu[m]&&i.defined(a[m])&&f.push(m);var c,C,h,b,g=f.length,A=J(t),T=J(t),x=[];x.length=s.length/3;var P=[];for(P.length=s.length/3,b=0;b<x.length;++b)x[b]=-1,P[b]=-1;var w=v.length;for(b=0;b<w;b+=3){var S=v[b],I=v[b+1],O=v[b+2],E=r.Cartesian3.fromArray(s,3*S),N=r.Cartesian3.fromArray(s,3*I),L=r.Cartesian3.fromArray(s,3*O),z=function(e,t,r){if(!(e.x>=0||t.x>=0||r.x>=0)){!function(e,t,r){if(0!==e.y&&0!==t.y&&0!==r.y)return k(e,e.y<0),k(t,t.y<0),void k(r,r.y<0);var a=Math.abs(e.y),i=Math.abs(t.y),s=Math.abs(r.y),o=(a>i?a>s?n.CesiumMath.sign(e.y):n.CesiumMath.sign(r.y):i>s?n.CesiumMath.sign(t.y):n.CesiumMath.sign(r.y))<0;k(e,o),k(t,o),k(r,o)}(e,t,r);var a,i=e.y<0,s=t.y<0,o=r.y<0;a=0+((i?1:0)+(s?1:0));var u=X.indices;1===(a+=o?1:0)?(u[1]=3,u[2]=4,u[5]=6,u[7]=6,u[8]=5,i?(U(e,t,Y,H),U(e,r,Z,W),u[0]=0,u[3]=1,u[4]=2,u[6]=1):s?(U(t,r,Y,H),U(t,e,Z,W),u[0]=1,u[3]=2,u[4]=0,u[6]=2):o&&(U(r,e,Y,H),U(r,t,Z,W),u[0]=2,u[3]=0,u[4]=1,u[6]=0)):2===a&&(u[2]=4,u[4]=4,u[5]=3,u[7]=5,u[8]=6,i?s?o||(U(r,e,Y,H),U(r,t,Z,W),u[0]=0,u[1]=1,u[3]=0,u[6]=2):(U(t,r,Y,H),U(t,e,Z,W),u[0]=2,u[1]=0,u[3]=2,u[6]=1):(U(e,t,Y,H),U(e,r,Z,W),u[0]=1,u[1]=2,u[3]=1,u[6]=0));var p=X.positions;return p[0]=e,p[1]=t,p[2]=r,p.length=3,1!==a&&2!==a||(p[3]=Y,p[4]=Z,p[5]=H,p[6]=W,p.length=7),X}}(E,N,L);if(i.defined(z)&&z.positions.length>3)for(var D=z.positions,M=z.indices,G=M.length,R=0;R<G;++R){var V=M[R],F=D[V];F.y<0?(c=T.attributes,C=T.indices,h=x):(c=A.attributes,C=A.indices,h=P),es(S,I,O,F,s,o,p,u,d,l,y,c,f,g,a,eo(c,C,h,v,V<3?b+V:-1,F))}else i.defined(z)&&(E=z.positions[0],N=z.positions[1],L=z.positions[2]),E.y<0?(c=T.attributes,C=T.indices,h=x):(c=A.attributes,C=A.indices,h=P),es(S,I,O,E,s,o,p,u,d,l,y,c,f,g,a,eo(c,C,h,v,b,E)),es(S,I,O,N,s,o,p,u,d,l,y,c,f,g,a,eo(c,C,h,v,b+1,N)),es(S,I,O,L,s,o,p,u,d,l,y,c,f,g,a,eo(c,C,h,v,b+2,L))}K(e,T,A)}var ed=l.Plane.fromPointNormal(r.Cartesian3.ZERO,r.Cartesian3.UNIT_Y),el=new r.Cartesian3,ey=new r.Cartesian3;function ev(e,t,a,s,o,u,p){if(i.defined(p)){var d=r.Cartesian3.fromArray(s,3*e,er);r.Cartesian3.equalsEpsilon(d,a,n.CesiumMath.EPSILON10)?u.applyOffset.values[o]=p[e]:u.applyOffset.values[o]=p[t]}}function ef(e){var t,a=e.geometry,s=a.attributes,o=s.position.values,u=i.defined(s.applyOffset)?s.applyOffset.values:void 0,p=a.indices,l=J(a),y=J(a),v=p.length,f=[];f.length=o.length/3;var m=[];for(m.length=o.length/3,t=0;t<f.length;++t)f[t]=-1,m[t]=-1;for(t=0;t<v;t+=2){var c,C,h,b=p[t],g=p[t+1],A=r.Cartesian3.fromArray(o,3*b,er),T=r.Cartesian3.fromArray(o,3*g,ea);Math.abs(A.y)<n.CesiumMath.EPSILON6&&(A.y<0?A.y=-n.CesiumMath.EPSILON6:A.y=n.CesiumMath.EPSILON6),Math.abs(T.y)<n.CesiumMath.EPSILON6&&(T.y<0?T.y=-n.CesiumMath.EPSILON6:T.y=n.CesiumMath.EPSILON6);var x=l.attributes,P=l.indices,w=m,S=y.attributes,I=y.indices,O=f,E=d.IntersectionTests.lineSegmentPlane(A,T,ed,ei);if(i.defined(E)){var N=r.Cartesian3.multiplyByScalar(r.Cartesian3.UNIT_Y,5*n.CesiumMath.EPSILON9,el);A.y<0&&(r.Cartesian3.negate(N,N),x=y.attributes,P=y.indices,w=f,S=l.attributes,I=l.indices,O=m);var L=r.Cartesian3.add(E,N,ey);ev(b,g,A,o,eo(x,P,w,p,t,A),x,u),ev(b,g,L,o,eo(x,P,w,p,-1,L),x,u),r.Cartesian3.negate(N,N),r.Cartesian3.add(E,N,L),ev(b,g,L,o,eo(S,I,O,p,-1,L),S,u),ev(b,g,T,o,eo(S,I,O,p,t+1,T),S,u)}else A.y<0?(c=y.attributes,C=y.indices,h=f):(c=l.attributes,C=l.indices,h=m),ev(b,g,A,o,eo(c,C,h,p,t,A),c,u),ev(b,g,T,o,eo(c,C,h,p,t+1,T),c,u)}K(e,y,l)}var em=new r.Cartesian2,ec=new r.Cartesian2,eC=new r.Cartesian3,eh=new r.Cartesian3,eb=new r.Cartesian3,eg=new r.Cartesian3,eA=new r.Cartesian3,eT=new r.Cartesian3,ex=new r.Cartesian4;function eP(e){for(var t=e.attributes,a=t.position.values,i=t.prevPosition.values,n=t.nextPosition.values,s=a.length,o=0;o<s;o+=3){var u=r.Cartesian3.unpack(a,o,eC);if(!(u.x>0)){var p=r.Cartesian3.unpack(i,o,eh);(u.y<0&&p.y>0||u.y>0&&p.y<0)&&(o-3>0?(i[o]=a[o-3],i[o+1]=a[o-2],i[o+2]=a[o-1]):r.Cartesian3.pack(u,i,o));var d=r.Cartesian3.unpack(n,o,eb);(u.y<0&&d.y>0||u.y>0&&d.y<0)&&(o+3<s?(n[o]=a[o+3],n[o+1]=a[o+4],n[o+2]=a[o+5]):r.Cartesian3.pack(u,n,o))}}}var ew=5*n.CesiumMath.EPSILON9,eS=n.CesiumMath.EPSILON6;c.splitLongitude=function(e){var t=e.geometry,a=t.boundingSphere;if(i.defined(a)&&(a.center.x-a.radius>0||s.BoundingSphere.intersectPlane(a,l.Plane.ORIGIN_ZX_PLANE)!==s.Intersect.INTERSECTING))return e;if(t.geometryType!==u.GeometryType.NONE)switch(t.geometryType){case u.GeometryType.POLYLINES:!function(e){var t,a,s,o=e.geometry,u=o.attributes,p=u.position.values,l=u.prevPosition.values,y=u.nextPosition.values,v=u.expandAndWidth.values,f=i.defined(u.st)?u.st.values:void 0,m=i.defined(u.color)?u.color.values:void 0,c=J(o),C=J(o),h=!1,b=p.length/3;for(t=0;t<b;t+=4){var g,A,T=t,x=t+2,P=r.Cartesian3.fromArray(p,3*T,eC),w=r.Cartesian3.fromArray(p,3*x,eh);if(Math.abs(P.y)<eS)for(P.y=eS*(w.y<0?-1:1),p[3*t+1]=P.y,p[3*(t+1)+1]=P.y,a=3*T;a<3*T+12;a+=3)l[a]=p[3*t],l[a+1]=p[3*t+1],l[a+2]=p[3*t+2];if(Math.abs(w.y)<eS)for(w.y=eS*(P.y<0?-1:1),p[3*(t+2)+1]=w.y,p[3*(t+3)+1]=w.y,a=3*T;a<3*T+12;a+=3)y[a]=p[3*(t+2)],y[a+1]=p[3*(t+2)+1],y[a+2]=p[3*(t+2)+2];var S=c.attributes,I=c.indices,O=C.attributes,E=C.indices,N=d.IntersectionTests.lineSegmentPlane(P,w,ed,eg);if(i.defined(N)){h=!0;var L=r.Cartesian3.multiplyByScalar(r.Cartesian3.UNIT_Y,ew,eA);P.y<0&&(r.Cartesian3.negate(L,L),S=C.attributes,I=C.indices,O=c.attributes,E=c.indices);var z=r.Cartesian3.add(N,L,eT);S.position.values.push(P.x,P.y,P.z,P.x,P.y,P.z),S.position.values.push(z.x,z.y,z.z),S.position.values.push(z.x,z.y,z.z),S.prevPosition.values.push(l[3*T],l[3*T+1],l[3*T+2]),S.prevPosition.values.push(l[3*T+3],l[3*T+4],l[3*T+5]),S.prevPosition.values.push(P.x,P.y,P.z,P.x,P.y,P.z),S.nextPosition.values.push(z.x,z.y,z.z),S.nextPosition.values.push(z.x,z.y,z.z),S.nextPosition.values.push(z.x,z.y,z.z),S.nextPosition.values.push(z.x,z.y,z.z),r.Cartesian3.negate(L,L),r.Cartesian3.add(N,L,z),O.position.values.push(z.x,z.y,z.z),O.position.values.push(z.x,z.y,z.z),O.position.values.push(w.x,w.y,w.z,w.x,w.y,w.z),O.prevPosition.values.push(z.x,z.y,z.z),O.prevPosition.values.push(z.x,z.y,z.z),O.prevPosition.values.push(z.x,z.y,z.z),O.prevPosition.values.push(z.x,z.y,z.z),O.nextPosition.values.push(w.x,w.y,w.z,w.x,w.y,w.z),O.nextPosition.values.push(y[3*x],y[3*x+1],y[3*x+2]),O.nextPosition.values.push(y[3*x+3],y[3*x+4],y[3*x+5]);var D=Math.abs(r.Cartesian2.fromArray(v,2*T,em).y);S.expandAndWidth.values.push(-1,D,1,D),S.expandAndWidth.values.push(-1,-D,1,-D),O.expandAndWidth.values.push(-1,D,1,D),O.expandAndWidth.values.push(-1,-D,1,-D);var M=r.Cartesian3.magnitudeSquared(r.Cartesian3.subtract(N,P,eb));if(M/=r.Cartesian3.magnitudeSquared(r.Cartesian3.subtract(w,P,eb)),i.defined(m)){var G=r.Cartesian4.fromArray(m,4*T,ex),R=r.Cartesian4.fromArray(m,4*x,ex),V=n.CesiumMath.lerp(G.x,R.x,M),F=n.CesiumMath.lerp(G.y,R.y,M),B=n.CesiumMath.lerp(G.z,R.z,M),_=n.CesiumMath.lerp(G.w,R.w,M);for(a=4*T;a<4*T+8;++a)S.color.values.push(m[a]);for(S.color.values.push(V,F,B,_),S.color.values.push(V,F,B,_),O.color.values.push(V,F,B,_),O.color.values.push(V,F,B,_),a=4*x;a<4*x+8;++a)O.color.values.push(m[a])}if(i.defined(f)){var k=r.Cartesian2.fromArray(f,2*T,em),q=r.Cartesian2.fromArray(f,2*(t+3),ec),U=n.CesiumMath.lerp(k.x,q.x,M);for(a=2*T;a<2*T+4;++a)S.st.values.push(f[a]);for(S.st.values.push(U,k.y),S.st.values.push(U,q.y),O.st.values.push(U,k.y),O.st.values.push(U,q.y),a=2*x;a<2*x+4;++a)O.st.values.push(f[a])}s=S.position.values.length/3-4,I.push(s,s+2,s+1),I.push(s+1,s+2,s+3),s=O.position.values.length/3-4,E.push(s,s+2,s+1),E.push(s+1,s+2,s+3)}else{for(P.y<0?(g=C.attributes,A=C.indices):(g=c.attributes,A=c.indices),g.position.values.push(P.x,P.y,P.z),g.position.values.push(P.x,P.y,P.z),g.position.values.push(w.x,w.y,w.z),g.position.values.push(w.x,w.y,w.z),a=3*t;a<3*t+12;++a)g.prevPosition.values.push(l[a]),g.nextPosition.values.push(y[a]);for(a=2*t;a<2*t+8;++a)g.expandAndWidth.values.push(v[a]),i.defined(f)&&g.st.values.push(f[a]);if(i.defined(m))for(a=4*t;a<4*t+16;++a)g.color.values.push(m[a]);s=g.position.values.length/3-4,A.push(s,s+2,s+1),A.push(s+1,s+2,s+3)}}h&&(eP(C),eP(c)),K(e,C,c)}(e);break;case u.GeometryType.TRIANGLES:ep(e);break;case u.GeometryType.LINES:ef(e)}else(function(e){switch(e.primitiveType){case u.PrimitiveType.TRIANGLE_FAN:return function(e){var t=u.Geometry.computeNumberOfVertices(e),r=p.IndexDatatype.createTypedArray(t,3*(t-2));r[0]=1,r[1]=0,r[2]=2;for(var a=3,i=3;i<t;++i)r[a++]=i-1,r[a++]=0,r[a++]=i;e.indices=r,e.primitiveType=u.PrimitiveType.TRIANGLES}(e);case u.PrimitiveType.TRIANGLE_STRIP:return function(e){var t=u.Geometry.computeNumberOfVertices(e),r=p.IndexDatatype.createTypedArray(t,3*(t-2));r[0]=0,r[1]=1,r[2]=2,t>3&&(r[3]=0,r[4]=2,r[5]=3);for(var a=6,i=3;i<t-1;i+=2)r[a++]=i,r[a++]=i-1,r[a++]=i+1,i+2<t&&(r[a++]=i,r[a++]=i+1,r[a++]=i+2);e.indices=r,e.primitiveType=u.PrimitiveType.TRIANGLES}(e);case u.PrimitiveType.TRIANGLES:return function(e){if(!i.defined(e.indices)){for(var t=u.Geometry.computeNumberOfVertices(e),r=p.IndexDatatype.createTypedArray(t,t),a=0;a<t;++a)r[a]=a;e.indices=r}}(e);case u.PrimitiveType.LINE_STRIP:return function(e){var t=u.Geometry.computeNumberOfVertices(e),r=p.IndexDatatype.createTypedArray(t,2*(t-1));r[0]=0,r[1]=1;for(var a=2,i=2;i<t;++i)r[a++]=i-1,r[a++]=i;e.indices=r,e.primitiveType=u.PrimitiveType.LINES}(e);case u.PrimitiveType.LINE_LOOP:return function(e){var t=u.Geometry.computeNumberOfVertices(e),r=p.IndexDatatype.createTypedArray(t,2*t);r[0]=0,r[1]=1;for(var a=2,i=2;i<t;++i)r[a++]=i-1,r[a++]=i;r[a++]=t-1,r[a]=0,e.indices=r,e.primitiveType=u.PrimitiveType.LINES}(e);case u.PrimitiveType.LINES:return function(e){if(!i.defined(e.indices)){for(var t=u.Geometry.computeNumberOfVertices(e),r=p.IndexDatatype.createTypedArray(t,t),a=0;a<t;++a)r[a]=a;e.indices=r}}(e)}})(t),t.primitiveType===u.PrimitiveType.TRIANGLES?ep(e):t.primitiveType===u.PrimitiveType.LINES&&ef(e);return e},e.GeometryPipeline=c});