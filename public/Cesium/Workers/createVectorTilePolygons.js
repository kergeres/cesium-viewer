define(["./AttributeCompression-0b8f7b7d","./Matrix3-b2351961","./Color-47068a02","./defaultValue-f6d5e6da","./IndexDatatype-a9b1bc18","./Math-355606c6","./OrientedBoundingBox-c083edd8","./Matrix2-7a8e9daf","./createTaskProcessorWorker","./ComponentDatatype-ab629b88","./WebGLConstants-7f557f93","./Transforms-f17097e5","./combine-0c102d93","./RuntimeError-9b4ce3fb","./EllipsoidTangentPlane-c3e9d965","./AxisAlignedBoundingBox-04c1a5e3","./IntersectionTests-f1b36d69","./Plane-5931b53e"],function(e,t,n,a,r,i,o,s,l,f,d,c,u,h,g,p,b,m){"use strict";let y=new t.Cartesian3,C=new t.Ellipsoid,I=new s.Rectangle,x={min:void 0,max:void 0,indexBytesPerElement:void 0},w=new t.Cartesian3,A=new t.Cartesian3,E=new t.Cartesian3,N=new t.Cartesian3,T=new t.Cartesian3,B=new t.Cartographic,k=new s.Rectangle;return l(function(l,f){let d;!function(e){let n=new Float64Array(e),a=0;x.indexBytesPerElement=n[a++],x.min=n[a++],x.max=n[a++],t.Cartesian3.unpack(n,a,y),a+=t.Cartesian3.packedLength,t.Ellipsoid.unpack(n,a,C),a+=t.Ellipsoid.packedLength,s.Rectangle.unpack(n,a,I)}(l.packedBuffer),d=2===x.indexBytesPerElement?new Uint16Array(l.indices):new Uint32Array(l.indices);let c=new Uint16Array(l.positions),u=new Uint32Array(l.counts),h=new Uint32Array(l.indexCounts),g=new Uint32Array(l.batchIds),p=new Uint32Array(l.batchTableColors),b=Array(u.length),m=I,L=x.min,O=x.max,U,P,F,M=l.minimumHeights,S=l.maximumHeights;a.defined(M)&&a.defined(S)&&(M=new Float32Array(M),S=new Float32Array(S));let D=c.length/2,R=c.subarray(0,D),_=c.subarray(D,2*D);e.AttributeCompression.zigZagDeltaDecode(R,_);let G=new Float64Array(3*D);for(U=0;U<D;++U){let e=R[U],n=_[U],a=i.CesiumMath.lerp(m.west,m.east,e/32767),r=i.CesiumMath.lerp(m.south,m.north,n/32767),o=t.Cartographic.fromRadians(a,r,0,B),s=C.cartographicToCartesian(o,w);t.Cartesian3.pack(s,G,3*U)}let V=u.length,Y=Array(V),v=Array(V),H=0,W=0;for(U=0;U<V;++U)Y[U]=H,v[U]=W,H+=u[U],W+=h[U];let z=new Float32Array(3*D*2),Z=new Uint16Array(2*D),j=new Uint32Array(v.length),q=new Uint32Array(h.length),J=[],K={};for(U=0;U<V;++U)F=p[U],a.defined(K[F])?(K[F].positionLength+=u[U],K[F].indexLength+=h[U],K[F].batchIds.push(U)):K[F]={positionLength:u[U],indexLength:h[U],offset:0,indexOffset:0,batchIds:[U]};let Q,X=0,$=0;for(F in K)if(K.hasOwnProperty(F)){(Q=K[F]).offset=X,Q.indexOffset=$;let e=2*Q.positionLength,t=2*Q.indexLength+6*Q.positionLength;X+=e,$+=t,Q.indexLength=t}let ee=[];for(F in K)K.hasOwnProperty(F)&&(Q=K[F],ee.push({color:n.Color.fromRgba(parseInt(F)),offset:Q.indexOffset,count:Q.indexLength,batchIds:Q.batchIds}));for(U=0;U<V;++U){Q=K[F=p[U]];let e=Q.offset,n=3*e,r=e,i=Y[U],s=u[U],l=g[U],f=L,c=O;a.defined(M)&&a.defined(S)&&(f=M[U],c=S[U]);let I=Number.POSITIVE_INFINITY,x=Number.NEGATIVE_INFINITY,D=Number.POSITIVE_INFINITY,R=Number.NEGATIVE_INFINITY;for(P=0;P<s;++P){let e=t.Cartesian3.unpack(G,3*i+3*P,w);C.scaleToGeodeticSurface(e,e);let a=C.cartesianToCartographic(e,B),o=a.latitude,s=a.longitude;I=Math.min(o,I),x=Math.max(o,x),D=Math.min(s,D),R=Math.max(s,R);let d=C.geodeticSurfaceNormal(e,A),u=t.Cartesian3.multiplyByScalar(d,f,E),h=t.Cartesian3.add(e,u,N);u=t.Cartesian3.multiplyByScalar(d,c,u);let g=t.Cartesian3.add(e,u,T);t.Cartesian3.subtract(g,y,g),t.Cartesian3.subtract(h,y,h),t.Cartesian3.pack(g,z,n),t.Cartesian3.pack(h,z,n+3),Z[r]=l,Z[r+1]=l,n+=6,r+=2}(m=k).west=D,m.east=R,m.south=I,m.north=x,b[U]=o.OrientedBoundingBox.fromRectangle(m,L,O,C);let _=Q.indexOffset,V=v[U],H=h[U];for(j[U]=_,P=0;P<H;P+=3){let t=d[V+P]-i,n=d[V+P+1]-i,a=d[V+P+2]-i;J[_++]=2*t+e,J[_++]=2*n+e,J[_++]=2*a+e,J[_++]=2*a+1+e,J[_++]=2*n+1+e,J[_++]=2*t+1+e}for(P=0;P<s;++P){let t=P,n=(P+1)%s;J[_++]=2*t+1+e,J[_++]=2*n+e,J[_++]=2*t+e,J[_++]=2*t+1+e,J[_++]=2*n+1+e,J[_++]=2*n+e}Q.offset+=2*s,Q.indexOffset=_,q[U]=_-j[U]}J=r.IndexDatatype.createTypedArray(z.length/3,J);let et=ee.length;for(let e=0;e<et;++e){let t=ee[e].batchIds,n=0,a=t.length;for(let e=0;e<a;++e)n+=q[t[e]];ee[e].count=n}let en=function(e,t,a){let r=t.length,i=2+r*o.OrientedBoundingBox.packedLength+1+function(e){let t=e.length,a=0;for(let r=0;r<t;++r)a+=n.Color.packedLength+3+e[r].batchIds.length;return a}(a),s=new Float64Array(i),l=0;s[l++]=e,s[l++]=r;for(let e=0;e<r;++e)o.OrientedBoundingBox.pack(t[e],s,l),l+=o.OrientedBoundingBox.packedLength;let f=a.length;s[l++]=f;for(let e=0;e<f;++e){let t=a[e];n.Color.pack(t.color,s,l),l+=n.Color.packedLength,s[l++]=t.offset,s[l++]=t.count;let r=t.batchIds,i=r.length;s[l++]=i;for(let e=0;e<i;++e)s[l++]=r[e]}return s}(2===J.BYTES_PER_ELEMENT?r.IndexDatatype.UNSIGNED_SHORT:r.IndexDatatype.UNSIGNED_INT,b,ee);return f.push(z.buffer,J.buffer,j.buffer,q.buffer,Z.buffer,en.buffer),{positions:z.buffer,indices:J.buffer,indexOffsets:j.buffer,indexCounts:q.buffer,batchIds:Z.buffer,packedBuffer:en.buffer}})});