define(["exports","./AxisAlignedBoundingBox-04c1a5e3","./Matrix2-7a8e9daf","./Matrix3-b2351961","./defaultValue-f6d5e6da","./IntersectionTests-f1b36d69","./Plane-5931b53e","./Transforms-f17097e5"],function(e,t,n,i,r,o,a,s){"use strict";let l=new n.Cartesian4;function d(e,t){e=(t=r.defaultValue(t,i.Ellipsoid.WGS84)).scaleToGeodeticSurface(e);let o=s.Transforms.eastNorthUpToFixedFrame(e,t);this._ellipsoid=t,this._origin=e,this._xAxis=i.Cartesian3.fromCartesian4(n.Matrix4.getColumn(o,0,l)),this._yAxis=i.Cartesian3.fromCartesian4(n.Matrix4.getColumn(o,1,l));let d=i.Cartesian3.fromCartesian4(n.Matrix4.getColumn(o,2,l));this._plane=a.Plane.fromPointNormal(e,d)}Object.defineProperties(d.prototype,{ellipsoid:{get:function(){return this._ellipsoid}},origin:{get:function(){return this._origin}},plane:{get:function(){return this._plane}},xAxis:{get:function(){return this._xAxis}},yAxis:{get:function(){return this._yAxis}},zAxis:{get:function(){return this._plane.normal}}});let c=new t.AxisAlignedBoundingBox;d.fromPoints=function(e,n){return new d(t.AxisAlignedBoundingBox.fromPoints(e,c).center,n)};let f=new o.Ray,p=new i.Cartesian3;d.prototype.projectPointOntoPlane=function(e,t){f.origin=e,i.Cartesian3.normalize(e,f.direction);let a=o.IntersectionTests.rayPlane(f,this._plane,p);if(r.defined(a)||(i.Cartesian3.negate(f.direction,f.direction),a=o.IntersectionTests.rayPlane(f,this._plane,p)),r.defined(a)){let e=i.Cartesian3.subtract(a,this._origin,a),o=i.Cartesian3.dot(this._xAxis,e),s=i.Cartesian3.dot(this._yAxis,e);return r.defined(t)?(t.x=o,t.y=s,t):new n.Cartesian2(o,s)}},d.prototype.projectPointsOntoPlane=function(e,t){r.defined(t)||(t=[]);let n=0,i=e.length;for(let o=0;o<i;o++){let i=this.projectPointOntoPlane(e[o],t[n]);r.defined(i)&&(t[n]=i,n++)}return t.length=n,t},d.prototype.projectPointToNearestOnPlane=function(e,t){r.defined(t)||(t=new n.Cartesian2),f.origin=e,i.Cartesian3.clone(this._plane.normal,f.direction);let a=o.IntersectionTests.rayPlane(f,this._plane,p);r.defined(a)||(i.Cartesian3.negate(f.direction,f.direction),a=o.IntersectionTests.rayPlane(f,this._plane,p));let s=i.Cartesian3.subtract(a,this._origin,a),l=i.Cartesian3.dot(this._xAxis,s),d=i.Cartesian3.dot(this._yAxis,s);return t.x=l,t.y=d,t},d.prototype.projectPointsToNearestOnPlane=function(e,t){r.defined(t)||(t=[]);let n=e.length;t.length=n;for(let i=0;i<n;i++)t[i]=this.projectPointToNearestOnPlane(e[i],t[i]);return t};let u=new i.Cartesian3;d.prototype.projectPointOntoEllipsoid=function(e,t){r.defined(t)||(t=new i.Cartesian3);let n=this._ellipsoid,o=this._origin,a=this._xAxis,s=this._yAxis;return i.Cartesian3.multiplyByScalar(a,e.x,u),t=i.Cartesian3.add(o,u,t),i.Cartesian3.multiplyByScalar(s,e.y,u),i.Cartesian3.add(t,u,t),n.scaleToGeocentricSurface(t,t),t},d.prototype.projectPointsOntoEllipsoid=function(e,t){let n=e.length;r.defined(t)?t.length=n:t=Array(n);for(let i=0;i<n;++i)t[i]=this.projectPointOntoEllipsoid(e[i],t[i]);return t},e.EllipsoidTangentPlane=d});