define(["./AttributeCompression-0b8f7b7d","./Transforms-f17097e5","./Matrix2-7a8e9daf","./Matrix3-b2351961","./defaultValue-f6d5e6da","./TerrainEncoding-c5a10c4f","./IndexDatatype-a9b1bc18","./Math-355606c6","./OrientedBoundingBox-c083edd8","./createTaskProcessorWorker","./ComponentDatatype-ab629b88","./WebGLConstants-7f557f93","./combine-0c102d93","./RuntimeError-9b4ce3fb","./EllipsoidTangentPlane-c3e9d965","./AxisAlignedBoundingBox-04c1a5e3","./IntersectionTests-f1b36d69","./Plane-5931b53e"],function(e,t,i,n,s,r,h,u,o,d,l,p,a,f,c,g,m,x){"use strict";var C={clipTriangleAtAxisAlignedThreshold:function(e,t,i,n,r,h){let u,o,d,l,p,a,f,c,g;s.defined(h)?h.length=0:h=[],t?(u=i<e,o=n<e,d=r<e):(u=i>e,o=n>e,d=r>e);let m=u+o+d;return 1===m?u?(l=(e-i)/(n-i),p=(e-i)/(r-i),h.push(1),h.push(2),1!==p&&(h.push(-1),h.push(0),h.push(2),h.push(p)),1!==l&&(h.push(-1),h.push(0),h.push(1),h.push(l))):o?(a=(e-n)/(r-n),f=(e-n)/(i-n),h.push(2),h.push(0),1!==f&&(h.push(-1),h.push(1),h.push(0),h.push(f)),1!==a&&(h.push(-1),h.push(1),h.push(2),h.push(a))):d&&(c=(e-r)/(i-r),g=(e-r)/(n-r),h.push(0),h.push(1),1!==g&&(h.push(-1),h.push(2),h.push(1),h.push(g)),1!==c&&(h.push(-1),h.push(2),h.push(0),h.push(c))):2===m?u||i===e?o||n===e?d||r===e||(p=(e-i)/(r-i),a=(e-n)/(r-n),h.push(2),h.push(-1),h.push(0),h.push(2),h.push(p),h.push(-1),h.push(1),h.push(2),h.push(a)):(g=(e-r)/(n-r),l=(e-i)/(n-i),h.push(1),h.push(-1),h.push(2),h.push(1),h.push(g),h.push(-1),h.push(0),h.push(1),h.push(l)):(f=(e-n)/(i-n),c=(e-r)/(i-r),h.push(0),h.push(-1),h.push(1),h.push(0),h.push(f),h.push(-1),h.push(2),h.push(0),h.push(c)):3!==m&&(h.push(0),h.push(1),h.push(2)),h},computeBarycentricCoordinates:function(e,t,i,r,h,u,o,d,l){let p=i-o,a=o-h,f=u-d,c=r-d,g=1/(f*p+a*c),m=t-d,x=e-o,C=(f*x+a*m)*g,w=(-c*x+p*m)*g,B=1-C-w;return s.defined(l)?(l.x=C,l.y=w,l.z=B,l):new n.Cartesian3(C,w,B)},computeLineSegmentLineSegmentIntersection:function(e,t,n,r,h,u,o,d,l){let p=(d-u)*(n-e)-(o-h)*(r-t);if(0===p)return;let a=((o-h)*(t-u)-(d-u)*(e-h))/p,f=((n-e)*(t-u)-(r-t)*(e-h))/p;return a>=0&&a<=1&&f>=0&&f<=1?(s.defined(l)||(l=new i.Cartesian2),l.x=e+a*(n-e),l.y=t+a*(r-t),l):void 0}};let w=[],B=[],y=[],b=new n.Cartographic,I=new n.Cartesian3,A=[],v=[],T=[],M=[],z=[],V=new n.Cartesian3,N=new t.BoundingSphere,E=new o.OrientedBoundingBox,R=new i.Cartesian2,H=new n.Cartesian3;function O(){this.vertexBuffer=void 0,this.index=void 0,this.first=void 0,this.second=void 0,this.ratio=void 0}O.prototype.clone=function(e){return s.defined(e)||(e=new O),e.uBuffer=this.uBuffer,e.vBuffer=this.vBuffer,e.heightBuffer=this.heightBuffer,e.normalBuffer=this.normalBuffer,e.index=this.index,e.first=this.first,e.second=this.second,e.ratio=this.ratio,e},O.prototype.initializeIndexed=function(e,t,i,n,s){this.uBuffer=e,this.vBuffer=t,this.heightBuffer=i,this.normalBuffer=n,this.index=s,this.first=void 0,this.second=void 0,this.ratio=void 0},O.prototype.initializeFromClipResult=function(e,t,i){let n=t+1;return -1!==e[t]?i[e[t]].clone(this):(this.vertexBuffer=void 0,this.index=void 0,this.first=i[e[n]],++n,this.second=i[e[n]],++n,this.ratio=e[n],++n),n},O.prototype.getKey=function(){return this.isIndexed()?this.index:JSON.stringify({first:this.first.getKey(),second:this.second.getKey(),ratio:this.ratio})},O.prototype.isIndexed=function(){return s.defined(this.index)},O.prototype.getH=function(){return s.defined(this.index)?this.heightBuffer[this.index]:u.CesiumMath.lerp(this.first.getH(),this.second.getH(),this.ratio)},O.prototype.getU=function(){return s.defined(this.index)?this.uBuffer[this.index]:u.CesiumMath.lerp(this.first.getU(),this.second.getU(),this.ratio)},O.prototype.getV=function(){return s.defined(this.index)?this.vBuffer[this.index]:u.CesiumMath.lerp(this.first.getV(),this.second.getV(),this.ratio)};let S=new i.Cartesian2,U=-1,F=[new n.Cartesian3,new n.Cartesian3],P=[new n.Cartesian3,new n.Cartesian3];function D(t,i){let s=F[++U],r=P[U];return s=e.AttributeCompression.octDecode(t.first.getNormalX(),t.first.getNormalY(),s),r=e.AttributeCompression.octDecode(t.second.getNormalX(),t.second.getNormalY(),r),I=n.Cartesian3.lerp(s,r,t.ratio,I),n.Cartesian3.normalize(I,I),e.AttributeCompression.octEncode(I,i),--U,i}O.prototype.getNormalX=function(){return s.defined(this.index)?this.normalBuffer[2*this.index]:(S=D(this,S)).x},O.prototype.getNormalY=function(){return s.defined(this.index)?this.normalBuffer[2*this.index+1]:(S=D(this,S)).y};let W=[];function X(e,t,i,n,r,h,u,o,d){if(0===u.length)return;let l=0,p=0;for(;p<u.length;)p=W[l++].initializeFromClipResult(u,p,o);for(let r=0;r<l;++r){let u=W[r];if(u.isIndexed())u.newIndex=h[u.index],u.uBuffer=e,u.vBuffer=t,u.heightBuffer=i,d&&(u.normalBuffer=n);else{let r=u.getKey();if(s.defined(h[r]))u.newIndex=h[r];else{let s=e.length;e.push(u.getU()),t.push(u.getV()),i.push(u.getH()),d&&(n.push(u.getNormalX()),n.push(u.getNormalY())),u.newIndex=s,h[r]=s}}}3===l?(r.push(W[0].newIndex),r.push(W[1].newIndex),r.push(W[2].newIndex)):4===l&&(r.push(W[0].newIndex),r.push(W[1].newIndex),r.push(W[2].newIndex),r.push(W[0].newIndex),r.push(W[2].newIndex),r.push(W[3].newIndex))}return W.push(new O),W.push(new O),W.push(new O),W.push(new O),d(function(e,s){let d,l,p,a,f,c,g;let m=e.isEastChild,x=e.isNorthChild,S=m?16383:0,U=m?32767:16383,F=x?16383:0,P=x?32767:16383;A.length=0,v.length=0,T.length=0,z.length=0,M.length=0;let D={},W=e.vertices,k=e.indices;k=k.subarray(0,e.indexCountWithoutSkirts);let K=r.TerrainEncoding.clone(e.encoding),L=K.hasVertexNormals,Y=0,_=e.vertexCountWithoutSkirts,G=e.minimumHeight,J=e.maximumHeight,Z=Array(_),j=Array(_),q=Array(_),Q=L?Array(2*_):void 0;for(l=0,p=0;l<_;++l,p+=2){let e=K.decodeTextureCoordinates(W,l,R);if(d=K.decodeHeight(W,l),a=u.CesiumMath.clamp(32767*e.x|0,0,32767),f=u.CesiumMath.clamp(32767*e.y|0,0,32767),q[l]=u.CesiumMath.clamp((d-G)/(J-G)*32767|0,0,32767),a<20&&(a=0),f<20&&(f=0),32767-a<20&&(a=32767),32767-f<20&&(f=32767),Z[l]=a,j[l]=f,L){let e=K.getOctEncodedNormal(W,l,H);Q[p]=e.x,Q[p+1]=e.y}(m&&a>=16383||!m&&a<=16383)&&(x&&f>=16383||!x&&f<=16383)&&(D[l]=Y,A.push(a),v.push(f),T.push(q[l]),L&&(z.push(Q[p]),z.push(Q[p+1])),++Y)}let $=[];$.push(new O),$.push(new O),$.push(new O);let ee=[];for(ee.push(new O),ee.push(new O),ee.push(new O),l=0;l<k.length;l+=3){let e=k[l],t=k[l+1],i=k[l+2],n=Z[e],s=Z[t],r=Z[i];$[0].initializeIndexed(Z,j,q,Q,e),$[1].initializeIndexed(Z,j,q,Q,t),$[2].initializeIndexed(Z,j,q,Q,i);let h=C.clipTriangleAtAxisAlignedThreshold(16383,m,n,s,r,w);(c=0)>=h.length||(c=ee[0].initializeFromClipResult(h,c,$))>=h.length||(c=ee[1].initializeFromClipResult(h,c,$))>=h.length||(c=ee[2].initializeFromClipResult(h,c,$),X(A,v,T,z,M,D,C.clipTriangleAtAxisAlignedThreshold(16383,x,ee[0].getV(),ee[1].getV(),ee[2].getV(),B),ee,L),c<h.length&&(ee[2].clone(ee[1]),ee[2].initializeFromClipResult(h,c,$),X(A,v,T,z,M,D,C.clipTriangleAtAxisAlignedThreshold(16383,x,ee[0].getV(),ee[1].getV(),ee[2].getV(),B),ee,L)))}let et=m?-32767:0,ei=x?-32767:0,en=[],es=[],er=[],eh=[],eu=Number.MAX_VALUE,eo=-eu;y.length=0;let ed=n.Ellipsoid.clone(e.ellipsoid),el=i.Rectangle.clone(e.childRectangle),ep=el.north,ea=el.south,ef=el.east,ec=el.west;for(ef<ec&&(ef+=u.CesiumMath.TWO_PI),l=0;l<A.length;++l)(a=Math.round(A[l]))<=S?(en.push(l),a=0):a>=U?(er.push(l),a=32767):a=2*a+et,A[l]=a,(f=Math.round(v[l]))<=F?(es.push(l),f=0):f>=P?(eh.push(l),f=32767):f=2*f+ei,v[l]=f,(d=u.CesiumMath.lerp(G,J,T[l]/32767))<eu&&(eu=d),d>eo&&(eo=d),T[l]=d,b.longitude=u.CesiumMath.lerp(ec,ef,a/32767),b.latitude=u.CesiumMath.lerp(ea,ep,f/32767),b.height=d,ed.cartographicToCartesian(b,I),y.push(I.x),y.push(I.y),y.push(I.z);let eg=t.BoundingSphere.fromVertices(y,n.Cartesian3.ZERO,3,N),em=o.OrientedBoundingBox.fromRectangle(el,eu,eo,ed,E),ex=new r.EllipsoidalOccluder(ed).computeHorizonCullingPointFromVerticesPossiblyUnderEllipsoid(eg.center,y,3,eg.center,eu,V),eC=eo-eu,ew=new Uint16Array(A.length+v.length+T.length);for(l=0;l<A.length;++l)ew[l]=A[l];let eB=A.length;for(l=0;l<v.length;++l)ew[eB+l]=v[l];for(eB+=v.length,l=0;l<T.length;++l)ew[eB+l]=32767*(T[l]-eu)/eC;let ey=h.IndexDatatype.createTypedArray(A.length,M);if(L){let e=new Uint8Array(z);s.push(ew.buffer,ey.buffer,e.buffer),g=e.buffer}else s.push(ew.buffer,ey.buffer);return{vertices:ew.buffer,encodedNormals:g,indices:ey.buffer,minimumHeight:eu,maximumHeight:eo,westIndices:en,southIndices:es,eastIndices:er,northIndices:eh,boundingSphere:eg,orientedBoundingBox:em,horizonOcclusionPoint:ex}})});