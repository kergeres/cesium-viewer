define(["./AxisAlignedBoundingBox-04c1a5e3","./Transforms-f17097e5","./Matrix2-7a8e9daf","./Matrix3-b2351961","./defaultValue-f6d5e6da","./TerrainEncoding-c5a10c4f","./Math-355606c6","./OrientedBoundingBox-c083edd8","./RuntimeError-9b4ce3fb","./WebMercatorProjection-db7467f4","./createTaskProcessorWorker","./combine-0c102d93","./AttributeCompression-0b8f7b7d","./ComponentDatatype-ab629b88","./WebGLConstants-7f557f93","./EllipsoidTangentPlane-c3e9d965","./IntersectionTests-f1b36d69","./Plane-5931b53e"],function(e,t,i,n,a,r,o,s,u,l,h,d,c,g,m,p,f,I){"use strict";let E=Uint16Array.BYTES_PER_ELEMENT,T=Int32Array.BYTES_PER_ELEMENT,C=Uint32Array.BYTES_PER_ELEMENT,M=Float32Array.BYTES_PER_ELEMENT,x=Float64Array.BYTES_PER_ELEMENT;function N(e,t,i){i=a.defaultValue(i,o.CesiumMath);let n=e.length;for(let a=0;a<n;++a)if(i.equalsEpsilon(e[a],t,o.CesiumMath.EPSILON12))return a;return -1}let b=new n.Cartographic,S=new n.Cartesian3,B=new n.Cartesian3,P=new n.Cartesian3,A=new i.Matrix4;function y(e,t,r,s,u,l,h,d,c,g,m){let p=d.length;for(let f=0;f<p;++f){let I=d[f],E=I.cartographic,T=I.index,C=e.length,M=E.longitude,x=E.latitude;x=o.CesiumMath.clamp(x,-o.CesiumMath.PI_OVER_TWO,o.CesiumMath.PI_OVER_TWO);let N=E.height-h.skirtHeight;h.hMin=Math.min(h.hMin,N),n.Cartographic.fromRadians(M,x,N,b),g&&(b.longitude+=c),g?f===p-1?b.latitude+=m:0===f&&(b.latitude-=m):b.latitude+=c;let B=h.ellipsoid.cartographicToCartesian(b);e.push(B),t.push(N),r.push(i.Cartesian2.clone(r[T])),s.length>0&&s.push(s[T]),u.length>0&&u.push(u[T]),i.Matrix4.multiplyByPoint(h.toENU,B,S);let P=h.minimum,A=h.maximum;n.Cartesian3.minimumByComponent(S,P,P),n.Cartesian3.maximumByComponent(S,A,A);let y=h.lastBorderPoint;if(a.defined(y)){let e=y.index;l.push(e,C-1,C,C,T,e)}h.lastBorderPoint=I}}return h(function(h,d){h.ellipsoid=n.Ellipsoid.clone(h.ellipsoid),h.rectangle=i.Rectangle.clone(h.rectangle);let c=function(h,d,c,g,m,p,f,I,R,w,_){let W,v,F,O,V,Y,U,k,H;a.defined(g)?(W=g.west,v=g.south,F=g.east,O=g.north,V=g.width,Y=g.height):(W=o.CesiumMath.toRadians(m.west),v=o.CesiumMath.toRadians(m.south),F=o.CesiumMath.toRadians(m.east),O=o.CesiumMath.toRadians(m.north),V=o.CesiumMath.toRadians(g.width),Y=o.CesiumMath.toRadians(g.height));let L=[v,O],D=[W,F],G=t.Transforms.eastNorthUpToFixedFrame(d,c),j=i.Matrix4.inverseTransformation(G,A);R&&(U=l.WebMercatorProjection.geodeticLatitudeToMercatorAngle(v),k=1/(l.WebMercatorProjection.geodeticLatitudeToMercatorAngle(O)-U));let z=1!==p,q=new DataView(h),J=Number.POSITIVE_INFINITY,K=Number.NEGATIVE_INFINITY;B.x=Number.POSITIVE_INFINITY,B.y=Number.POSITIVE_INFINITY,B.z=Number.POSITIVE_INFINITY,P.x=Number.NEGATIVE_INFINITY,P.y=Number.NEGATIVE_INFINITY,P.z=Number.NEGATIVE_INFINITY;let Q,X,Z=0,$=0,ee=0;for(X=0;X<4;++X){let e=Z;Q=q.getUint32(e,!0),e+=C;let t=o.CesiumMath.toRadians(180*q.getFloat64(e,!0));e+=x,-1===N(D,t)&&D.push(t);let i=o.CesiumMath.toRadians(180*q.getFloat64(e,!0));e+=x,-1===N(L,i)&&L.push(i),e+=2*x;let n=q.getInt32(e,!0);e+=T,$+=n,ee+=3*(n=q.getInt32(e,!0)),Z+=Q+C}let et=[],ei=[],en=Array($),ea=Array($),er=Array($),eo=R?Array($):[],es=z?Array($):[],eu=Array(ee),el=[],eh=[],ed=[],ec=[],eg=0,em=0;for(Z=0,X=0;X<4;++X){Q=q.getUint32(Z,!0),Z+=C;let e=Z,t=o.CesiumMath.toRadians(180*q.getFloat64(Z,!0));Z+=x;let a=o.CesiumMath.toRadians(180*q.getFloat64(Z,!0));Z+=x;let r=o.CesiumMath.toRadians(180*q.getFloat64(Z,!0)),s=.5*r;Z+=x;let h=o.CesiumMath.toRadians(180*q.getFloat64(Z,!0)),d=.5*h;Z+=x;let g=q.getInt32(Z,!0);Z+=T;let m=q.getInt32(Z,!0);Z+=T+T;let p=Array(g);for(let e=0;e<g;++e){let u=t+q.getUint8(Z++)*r;b.longitude=u;let g=a+q.getUint8(Z++)*h;b.latitude=g;let m=q.getFloat32(Z,!0);if(Z+=M,0!==m&&m<_&&(m*=-Math.pow(2,w)),m*=6371010,b.height=m,-1!==N(D,u)||-1!==N(L,g)){let t=N(et,b,n.Cartographic);if(-1!==t){p[e]=ei[t];continue}et.push(n.Cartographic.clone(b)),ei.push(eg)}p[e]=eg,Math.abs(u-W)<s?el.push({index:eg,cartographic:n.Cartographic.clone(b)}):Math.abs(u-F)<s?ed.push({index:eg,cartographic:n.Cartographic.clone(b)}):Math.abs(g-v)<d?eh.push({index:eg,cartographic:n.Cartographic.clone(b)}):Math.abs(g-O)<d&&ec.push({index:eg,cartographic:n.Cartographic.clone(b)}),J=Math.min(m,J),K=Math.max(m,K),er[eg]=m;let f=c.cartographicToCartesian(b);if(en[eg]=f,R&&(eo[eg]=(l.WebMercatorProjection.geodeticLatitudeToMercatorAngle(g)-U)*k),z){let e=c.geodeticSurfaceNormal(f);es[eg]=e}i.Matrix4.multiplyByPoint(j,f,S),n.Cartesian3.minimumByComponent(S,B,B),n.Cartesian3.maximumByComponent(S,P,P);let I=(u-W)/(F-W);I=o.CesiumMath.clamp(I,0,1);let E=(g-v)/(O-v);E=o.CesiumMath.clamp(E,0,1),ea[eg]=new i.Cartesian2(I,E),++eg}let f=3*m;for(let e=0;e<f;++e,++em)eu[em]=p[q.getUint16(Z,!0)],Z+=E;if(Q!==Z-e)throw new u.RuntimeError("Invalid terrain tile.")}en.length=eg,ea.length=eg,er.length=eg,R&&(eo.length=eg),z&&(es.length=eg);let ep=eg,ef=em,eI={hMin:J,lastBorderPoint:void 0,skirtHeight:I,toENU:j,ellipsoid:c,minimum:B,maximum:P};if(el.sort(function(e,t){return t.cartographic.latitude-e.cartographic.latitude}),eh.sort(function(e,t){return e.cartographic.longitude-t.cartographic.longitude}),ed.sort(function(e,t){return e.cartographic.latitude-t.cartographic.latitude}),ec.sort(function(e,t){return t.cartographic.longitude-e.cartographic.longitude}),y(en,er,ea,eo,es,eu,eI,el,-.00001*V,!0,-.00001*Y),y(en,er,ea,eo,es,eu,eI,eh,-.00001*Y,!1),y(en,er,ea,eo,es,eu,eI,ed,1e-5*V,!0,1e-5*Y),y(en,er,ea,eo,es,eu,eI,ec,1e-5*Y,!1),el.length>0&&ec.length>0){let e=el[0].index,t=ec[ec.length-1].index,i=en.length-1;eu.push(t,i,ep,ep,e,t)}$=en.length;let eE=t.BoundingSphere.fromPoints(en);a.defined(g)&&(H=s.OrientedBoundingBox.fromRectangle(g,J,K,c));let eT=new r.EllipsoidalOccluder(c).computeHorizonCullingPointPossiblyUnderEllipsoid(d,en,J),eC=new e.AxisAlignedBoundingBox(B,P,d),eM=new r.TerrainEncoding(d,eC,eI.hMin,K,G,!1,R,z,p,f),ex=new Float32Array($*eM.stride),eN=0;for(let e=0;e<$;++e)eN=eM.encode(ex,eN,en[e],ea[e],er[e],void 0,eo[e],es[e]);let eb=el.map(function(e){return e.index}).reverse(),eS=eh.map(function(e){return e.index}).reverse(),eB=ed.map(function(e){return e.index}).reverse(),eP=ec.map(function(e){return e.index}).reverse();return eS.unshift(eB[eB.length-1]),eS.push(eb[0]),eP.unshift(eb[eb.length-1]),eP.push(eB[0]),{vertices:ex,indices:new Uint16Array(eu),maximumHeight:K,minimumHeight:J,encoding:eM,boundingSphere3D:eE,orientedBoundingBox:H,occludeePointInScaledSpace:eT,vertexCountWithoutSkirts:ep,indexCountWithoutSkirts:ef,westIndicesSouthToNorth:eb,southIndicesEastToWest:eS,eastIndicesNorthToSouth:eB,northIndicesWestToEast:eP}}(h.buffer,h.relativeToCenter,h.ellipsoid,h.rectangle,h.nativeRectangle,h.exaggeration,h.exaggerationRelativeHeight,h.skirtHeight,h.includeWebMercatorT,h.negativeAltitudeExponentBias,h.negativeElevationThreshold),g=c.vertices;d.push(g.buffer);let m=c.indices;return d.push(m.buffer),{vertices:g.buffer,indices:m.buffer,numberOfAttributes:c.encoding.stride,minimumHeight:c.minimumHeight,maximumHeight:c.maximumHeight,boundingSphere3D:c.boundingSphere3D,orientedBoundingBox:c.orientedBoundingBox,occludeePointInScaledSpace:c.occludeePointInScaledSpace,encoding:c.encoding,vertexCountWithoutSkirts:c.vertexCountWithoutSkirts,indexCountWithoutSkirts:c.indexCountWithoutSkirts,westIndicesSouthToNorth:c.westIndicesSouthToNorth,southIndicesEastToWest:c.southIndicesEastToWest,eastIndicesNorthToSouth:c.eastIndicesNorthToSouth,northIndicesWestToEast:c.northIndicesWestToEast}})});