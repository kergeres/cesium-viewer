define(["exports","./ArcType-26a3f38d","./arrayRemoveDuplicates-0d8dde26","./Matrix2-7a8e9daf","./Matrix3-b2351961","./ComponentDatatype-ab629b88","./defaultValue-f6d5e6da","./EllipsoidRhumbLine-1289f7e8","./GeometryAttribute-9c1a6bab","./GeometryAttributes-1e4ddcd2","./GeometryPipeline-a9233ae3","./IndexDatatype-a9b1bc18","./Math-355606c6","./PolygonPipeline-3fa47499","./Transforms-f17097e5"],function(e,t,i,n,r,a,o,s,l,u,c,h,d,p,f){"use strict";function y(){this._array=[],this._offset=0,this._length=0}Object.defineProperties(y.prototype,{length:{get:function(){return this._length}}}),y.prototype.enqueue=function(e){this._array.push(e),this._length++},y.prototype.dequeue=function(){if(0===this._length)return;let e=this._array,t=this._offset,i=e[t];return e[t]=void 0,++t>10&&2*t>e.length&&(this._array=e.slice(t),t=0),this._offset=t,this._length--,i},y.prototype.peek=function(){if(0!==this._length)return this._array[this._offset]},y.prototype.contains=function(e){return -1!==this._array.indexOf(e)},y.prototype.clear=function(){this._array.length=this._offset=this._length=0},y.prototype.sort=function(e){this._offset>0&&(this._array=this._array.slice(this._offset),this._offset=0),this._array.sort(e)};let g={computeHierarchyPackedLength:function(e,t){let i=0,n=[e];for(;n.length>0;){let e=n.pop();if(!o.defined(e))continue;i+=2;let r=e.positions,a=e.holes;if(o.defined(r)&&r.length>0&&(i+=r.length*t.packedLength),o.defined(a)){let e=a.length;for(let t=0;t<e;++t)n.push(a[t])}}return i},packPolygonHierarchy:function(e,t,i,n){let r=[e];for(;r.length>0;){let e=r.pop();if(!o.defined(e))continue;let a=e.positions,s=e.holes;if(t[i++]=o.defined(a)?a.length:0,t[i++]=o.defined(s)?s.length:0,o.defined(a)){let e=a.length;for(let r=0;r<e;++r,i+=n.packedLength)n.pack(a[r],t,i)}if(o.defined(s)){let e=s.length;for(let t=0;t<e;++t)r.push(s[t])}}return i},unpackPolygonHierarchy:function(e,t,i){let n=e[t++],r=e[t++],a=Array(n),o=r>0?Array(r):void 0;for(let r=0;r<n;++r,t+=i.packedLength)a[r]=i.unpack(e,t);for(let n=0;n<r;++n)o[n]=g.unpackPolygonHierarchy(e,t,i),t=o[n].startingIndex,delete o[n].startingIndex;return{positions:a,holes:o,startingIndex:t}}},m=new n.Cartesian2;function C(e,t,i,r){return n.Cartesian2.subtract(t,e,m),n.Cartesian2.multiplyByScalar(m,i/r,m),n.Cartesian2.add(e,m,m),[m.x,m.y]}let b=new r.Cartesian3;g.subdivideLineCount=function(e,t,i){let n=r.Cartesian3.distance(e,t)/i,a=Math.max(0,Math.ceil(d.CesiumMath.log2(n)));return Math.pow(2,a)};let x=new r.Cartographic,T=new r.Cartographic,v=new r.Cartographic,A=new r.Cartesian3,L=new s.EllipsoidRhumbLine;g.subdivideRhumbLineCount=function(e,t,i,n){let r=e.cartesianToCartographic(t,x),a=e.cartesianToCartographic(i,T),o=new s.EllipsoidRhumbLine(r,a,e).surfaceDistance/n,l=Math.max(0,Math.ceil(d.CesiumMath.log2(o)));return Math.pow(2,l)},g.subdivideTexcoordLine=function(e,t,i,r,a,o){let s=g.subdivideLineCount(i,r,a),l=n.Cartesian2.distance(e,t),u=l/s;o.length=2*s;let c=0;for(let i=0;i<s;i++){let n=C(e,t,i*u,l);o[c++]=n[0],o[c++]=n[1]}return o},g.subdivideLine=function(e,t,i,n){let a=g.subdivideLineCount(e,t,i),s=r.Cartesian3.distance(e,t),l=s/a;o.defined(n)||(n=[]);let u=n;u.length=3*a;let c=0;for(let i=0;i<a;i++){var h;let n=(h=i*l,r.Cartesian3.subtract(t,e,b),r.Cartesian3.multiplyByScalar(b,h/s,b),r.Cartesian3.add(e,b,b),[b.x,b.y,b.z]);u[c++]=n[0],u[c++]=n[1],u[c++]=n[2]}return u},g.subdivideTexcoordRhumbLine=function(e,t,i,r,a,o,s){let l=i.cartesianToCartographic(r,x),u=i.cartesianToCartographic(a,T);L.setEndPoints(l,u);let c=L.surfaceDistance/o,h=Math.max(0,Math.ceil(d.CesiumMath.log2(c))),p=Math.pow(2,h),f=n.Cartesian2.distance(e,t),y=f/p;s.length=2*p;let g=0;for(let i=0;i<p;i++){let n=C(e,t,i*y,f);s[g++]=n[0],s[g++]=n[1]}return s},g.subdivideRhumbLine=function(e,t,i,n,r){let a=e.cartesianToCartographic(t,x),l=e.cartesianToCartographic(i,T),u=new s.EllipsoidRhumbLine(a,l,e),c=u.surfaceDistance/n,h=Math.max(0,Math.ceil(d.CesiumMath.log2(c))),p=Math.pow(2,h),f=u.surfaceDistance/p;o.defined(r)||(r=[]);let y=r;y.length=3*p;let g=0;for(let t=0;t<p;t++){let i=u.interpolateUsingSurfaceDistance(t*f,v),n=e.cartographicToCartesian(i,A);y[g++]=n.x,y[g++]=n.y,y[g++]=n.z}return y};let w=new r.Cartesian3,E=new r.Cartesian3,I=new r.Cartesian3,M=new r.Cartesian3;g.scaleToGeodeticHeightExtruded=function(e,t,i,n,a){n=o.defaultValue(n,r.Ellipsoid.WGS84);let s=E,l=M;if(o.defined(e)&&o.defined(e.attributes)&&o.defined(e.attributes.position)){let o=e.attributes.position.values,u=o.length/2;for(let e=0;e<u;e+=3)r.Cartesian3.fromArray(o,e,I),n.geodeticSurfaceNormal(I,w),l=n.scaleToGeodeticSurface(I,l),s=r.Cartesian3.multiplyByScalar(w,i,s),s=r.Cartesian3.add(l,s,s),o[e+u]=s.x,o[e+1+u]=s.y,o[e+2+u]=s.z,a&&(l=r.Cartesian3.clone(I,l)),s=r.Cartesian3.multiplyByScalar(w,t,s),s=r.Cartesian3.add(l,s,s),o[e]=s.x,o[e+1]=s.y,o[e+2]=s.z}return e},g.polygonOutlinesFromHierarchy=function(e,t,n){let a,s,l;let u=[],c=new y;for(c.enqueue(e);0!==c.length;){let e=c.dequeue(),h=e.positions;if(t)for(l=h.length,a=0;a<l;a++)n.scaleToGeodeticSurface(h[a],h[a]);if((h=i.arrayRemoveDuplicates(h,r.Cartesian3.equalsEpsilon,!0)).length<3)continue;let d=e.holes?e.holes.length:0;for(a=0;a<d;a++){let h=e.holes[a],d=h.positions;if(t)for(l=d.length,s=0;s<l;++s)n.scaleToGeodeticSurface(d[s],d[s]);if((d=i.arrayRemoveDuplicates(d,r.Cartesian3.equalsEpsilon,!0)).length<3)continue;u.push(d);let p=0;for(o.defined(h.holes)&&(p=h.holes.length),s=0;s<p;s++)c.enqueue(h.holes[s])}u.push(h)}return u},g.polygonsFromHierarchy=function(e,t,n,a,s){let l=[],u=[],c=new y;for(c.enqueue(e);0!==c.length;){let e,h,d;let f=c.dequeue(),y=f.positions,g=f.holes;if(a)for(h=y.length,e=0;e<h;e++)s.scaleToGeodeticSurface(y[e],y[e]);if(t||(y=i.arrayRemoveDuplicates(y,r.Cartesian3.equalsEpsilon,!0)),y.length<3)continue;let m=n(y);if(!o.defined(m))continue;let C=[],b=p.PolygonPipeline.computeWindingOrder2D(m);b===p.WindingOrder.CLOCKWISE&&(m.reverse(),y=y.slice().reverse());let x=y.slice(),T=o.defined(g)?g.length:0,v=[];for(e=0;e<T;e++){let l=g[e],u=l.positions;if(a)for(h=u.length,d=0;d<h;++d)s.scaleToGeodeticSurface(u[d],u[d]);if(t||(u=i.arrayRemoveDuplicates(u,r.Cartesian3.equalsEpsilon,!0)),u.length<3)continue;let f=n(u);if(!o.defined(f))continue;(b=p.PolygonPipeline.computeWindingOrder2D(f))===p.WindingOrder.CLOCKWISE&&(f.reverse(),u=u.slice().reverse()),v.push(u),C.push(x.length),x=x.concat(u),m=m.concat(f);let y=0;for(o.defined(l.holes)&&(y=l.holes.length),d=0;d<y;d++)c.enqueue(l.holes[d])}l.push({outerRing:y,holes:v}),u.push({positions:x,positions2D:m,holes:C})}return{hierarchy:l,polygons:u}};let P=new n.Cartesian2,D=new r.Cartesian3,_=new f.Quaternion,G=new r.Matrix3;g.computeBoundingRectangle=function(e,t,i,n,a){let s=f.Quaternion.fromAxisAngle(e,n,_),l=r.Matrix3.fromQuaternion(s,G),u=Number.POSITIVE_INFINITY,c=Number.NEGATIVE_INFINITY,h=Number.POSITIVE_INFINITY,d=Number.NEGATIVE_INFINITY,p=i.length;for(let e=0;e<p;++e){let n=r.Cartesian3.clone(i[e],D);r.Matrix3.multiplyByVector(l,n,n);let a=t(n,P);o.defined(a)&&(u=Math.min(u,a.x),c=Math.max(c,a.x),h=Math.min(h,a.y),d=Math.max(d,a.y))}return a.x=u,a.y=h,a.width=c-u,a.height=d-h,a},g.createGeometryFromPositions=function(e,i,r,s,u,h,d){let f=p.PolygonPipeline.triangulate(i.positions2D,i.holes);f.length<3&&(f=[0,1,2]);let y=i.positions,g=o.defined(r),m=g?r.positions:void 0;if(u){let e=y.length,t=Array(3*e),i=0;for(let n=0;n<e;n++){let e=y[n];t[i++]=e.x,t[i++]=e.y,t[i++]=e.z}let r={attributes:{position:new l.GeometryAttribute({componentDatatype:a.ComponentDatatype.DOUBLE,componentsPerAttribute:3,values:t})},indices:f,primitiveType:l.PrimitiveType.TRIANGLES};g&&(r.attributes.st=new l.GeometryAttribute({componentDatatype:a.ComponentDatatype.FLOAT,componentsPerAttribute:2,values:n.Cartesian2.packArray(m)}));let o=new l.Geometry(r);return h.normal?c.GeometryPipeline.computeNormal(o):o}return d===t.ArcType.GEODESIC?p.PolygonPipeline.computeSubdivision(e,y,f,m,s):d===t.ArcType.RHUMB?p.PolygonPipeline.computeRhumbLineSubdivision(e,y,f,m,s):void 0};let S=[],R=[],N=new r.Cartesian3,O=new r.Cartesian3;g.computeWallGeometry=function(e,i,n,s,c,p){let f,y,m,C,b,x,T,v,A,L=e.length,w=0,E=0,I=o.defined(i),M=I?i.positions:void 0;if(c)for(f=Array(2*(y=3*L*2)),I&&(v=Array(2*(A=2*L*2))),m=0;m<L;m++)C=e[m],b=e[(m+1)%L],f[w]=f[w+y]=C.x,f[++w]=f[w+y]=C.y,f[++w]=f[w+y]=C.z,f[++w]=f[w+y]=b.x,f[++w]=f[w+y]=b.y,f[++w]=f[w+y]=b.z,++w,I&&(x=M[m],T=M[(m+1)%L],v[E]=v[E+A]=x.x,v[++E]=v[E+A]=x.y,v[++E]=v[E+A]=T.x,v[++E]=v[E+A]=T.y,++E);else{let i=d.CesiumMath.chordLength(s,n.maximumRadius),r=0;if(p===t.ArcType.GEODESIC)for(m=0;m<L;m++)r+=g.subdivideLineCount(e[m],e[(m+1)%L],i);else if(p===t.ArcType.RHUMB)for(m=0;m<L;m++)r+=g.subdivideRhumbLineCount(n,e[m],e[(m+1)%L],i);for(f=Array(2*(y=3*(r+L))),I&&(v=Array(2*(A=2*(r+L)))),m=0;m<L;m++){let r,a;C=e[m],b=e[(m+1)%L],I&&(x=M[m],T=M[(m+1)%L]),p===t.ArcType.GEODESIC?(r=g.subdivideLine(C,b,i,R),I&&(a=g.subdivideTexcoordLine(x,T,C,b,i,S))):p===t.ArcType.RHUMB&&(r=g.subdivideRhumbLine(n,C,b,i,R),I&&(a=g.subdivideTexcoordRhumbLine(x,T,n,C,b,i,S)));let o=r.length;for(let e=0;e<o;++e,++w)f[w]=r[e],f[w+y]=r[e];if(f[w]=b.x,f[w+y]=b.x,f[++w]=b.y,f[w+y]=b.y,f[++w]=b.z,f[w+y]=b.z,++w,I){let e=a.length;for(let t=0;t<e;++t,++E)v[E]=a[t],v[E+A]=a[t];v[E]=T.x,v[E+A]=T.x,v[++E]=T.y,v[E+A]=T.y,++E}}}L=f.length;let P=h.IndexDatatype.createTypedArray(L/3,L-6*e.length),D=0;for(L/=6,m=0;m<L;m++){let e=m,t=e+1,i=e+L,n=i+1;C=r.Cartesian3.fromArray(f,3*e,N),b=r.Cartesian3.fromArray(f,3*t,O),r.Cartesian3.equalsEpsilon(C,b,d.CesiumMath.EPSILON10,d.CesiumMath.EPSILON10)||(P[D++]=e,P[D++]=i,P[D++]=t,P[D++]=t,P[D++]=i,P[D++]=n)}let _={attributes:new u.GeometryAttributes({position:new l.GeometryAttribute({componentDatatype:a.ComponentDatatype.DOUBLE,componentsPerAttribute:3,values:f})}),indices:P,primitiveType:l.PrimitiveType.TRIANGLES};return I&&(_.attributes.st=new l.GeometryAttribute({componentDatatype:a.ComponentDatatype.FLOAT,componentsPerAttribute:2,values:v})),new l.Geometry(_)},e.PolygonGeometryLibrary=g});